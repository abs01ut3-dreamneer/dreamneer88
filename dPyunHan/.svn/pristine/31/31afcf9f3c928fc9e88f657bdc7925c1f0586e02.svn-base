<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<style>
/* ===== Footer 기본 구조 ===== */
footer.footer {
  background-color: #1b1f22; /* dark 배경 */
  color: #fff;
  width: 100%;
  position: relative;
  bottom: 0;
  left: 0;
  z-index: 50;
  padding: 8px 0;
  text-align: center;
  border-top: 1px solid rgba(255,255,255,0.1);
}

/* ===== Footer 메뉴 정확히 5등분 ===== */
#footer-navmenu ul {
  display: grid !important;
  grid-template-columns: repeat(5, minmax(0, 1fr));
  justify-items: center;
  align-items: start;
  margin: 0;
  padding: 0;
  list-style: none;
  gap: 24px; /* 항목 간격 확대 */
}

/* ===== Footer 각 항목 ===== */
#footer-navmenu li {
  width: 100%;
  text-align: center;
}

/* ===== 링크 (아이콘 + 글자) ===== */
#footer-navmenu a {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  color: #fff !important;
  text-decoration: none !important;
  font-size: 0.8rem;
  font-weight: 500;
  line-height: 1.1;
  padding-top: 0;
}

/* 아이콘 크기 */
#footer-navmenu a i {
  font-size: 1.5rem;
  margin-bottom: 2px;
  transform: translateY(0px);
  transition: color 0.25s ease-in-out;
}

/* hover 시 아이콘만 주황색 */
#footer-navmenu a:hover i {
  color: #ff4a17 !important;
}

/* active 상태(현재 섹션)에 있을 때 아이콘 주황색 */
#footer-navmenu a.active i {
  color: #ff4a17 !important;
}

/* 글자는 항상 흰색 유지 */
#footer-navmenu a span {
  color: #fff !important;
}

/* footer 높이 확보 */
.mobile-frame {
  padding-bottom: 85px !important;
}

/* ===== 반응형 ===== */
@media (max-width: 480px) {
  #footer-navmenu ul {
    grid-template-columns: repeat(5, 1fr);
  }
  #footer-navmenu a {
    font-size: 0.72rem;
  }
  #footer-navmenu a i {
    font-size: 1.2rem;
  }
}
</style>


<!-- 나혜선 추가 시작 -->
<style>
#chatBox {
  display: none;
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 478px;
  height: 450px;
  border-radius: 10px;
  overflow: hidden;
  transition: all 0.3s ease;
  z-index: 9999;
  background: transparent !important;   /* ← 추가 */
  box-shadow: none !important;          /* ← 추가 */
  border: none !important;              /* ← 추가 */
}

#chatBox iframe {
  width: 100%;
  height: 100%;
  border: none;
  background: transparent !important;
}

 #dragHandle{
  position:absolute;
  top:0;
  left:0;
  width:100%;         
  height:20px;         
  cursor:move;
  z-index:10000;
  background:transparent;
}
.chat-wrapper {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  background: #fff;
  border-radius: 20px;
  overflow: hidden;
}
/* 헤더는 고정 */
.chat-header {
  flex: 0 0 48px;    /* 정확히 48px */
}
/* 입력창 고정 */
.chat-input {
  flex: 0 0 65px;    /* 원하는 값으로 조절 */
}
/* 채팅내용은 남는 공간을 100% 사용 */
.chat-body {
  flex: 1 1 auto;
  overflow-y: auto;
}
/* 최소화: 부모 박스도 함께 줄이기 + iframe 숨김 */
#chatBox.minimized{
  width:auto !important;
  height:40px !important;   /* 헤더만 남김 */
  background:transparent !important;
  box-shadow:none !important;
  border:none !important;
  overflow:visible !important;
}

#chatBox.minimized iframe{
  display:none !important;
}

#chatBox.dragging iframe {
  pointer-events: none;
}

</style>

<!-- 나혜선 추가 끝 -->

<!-- ===== Footer (Dewi / Bootstrap 5) ===== -->
<footer id="footer" class="footer dark-background">
  <!-- ❌ 여기에 d-flex 절대 넣지 말 것 -->
  <div class="px-0">  
    <nav id="footer-navmenu" class="footer-menu mx-auto">
      <ul>
        <li><a href="/main#levy"><i class="bi bi-cash-coin"></i><span>관리비</span></a></li>
        <li><a href="/main#notice"><i class="bi bi-megaphone-fill"></i><span>공지</span></a></li>
        <li><a href="/main#home"><i class="bi bi-house-fill"></i><span>홈</span></a></li>
        <li><a href="/main#resve"><i class="bi bi-building-fill"></i><span>편의시설</span></a></li>
        <li><a class="chatBtn"><i class="bi bi-chat-square-dots-fill"></i><span>채팅</span></a></li>
      </ul>
      
        
    </nav>
  </div>
</footer>

<!-- Scroll Top -->
<a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center">
    <i class="bi bi-arrow-up-short"></i>
</a>
</div> <!-- ✅ mobile-frame 닫음 -->

<!-- 나혜선 채팅 시작 -->      
 <div id="chatBox">  <!-- 채팅창 -->
    <div id="dragHandle"></div>  <!-- 드래그 하기 위해 잡는 영역 -->
        <iframe id="chatFrame"></iframe>   <!--내부 내용은 jsp에서 작성 -->
</div>
<!-- 나혜선 채팅 끝 -->

<!-- Preloader -->
<div id="preloader"></div>

<!-- ===== JS (Bootstrap 5 / Dewi) ===== -->
<script src="/dewi/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/dewi/assets/vendor/php-email-form/validate.js"></script>
<script src="/dewi/assets/vendor/aos/aos.js"></script>
<script src="/dewi/assets/vendor/glightbox/js/glightbox.min.js"></script>
<script src="/dewi/assets/vendor/purecounter/purecounter_vanilla.js"></script>
<script src="/dewi/assets/vendor/swiper/swiper-bundle.min.js"></script>
<script src="/dewi/assets/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
<script src="/dewi/assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
<script src="https://cdn.portone.io/v2/browser-sdk.js" async defer></script>
<script src="/dewi/assets/js/main.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const frame  = document.querySelector('.mobile-frame');
    const header = frame?.querySelector('#header');
    if (!frame || !header) return;

    const TH = 60;
    const onScroll = () => header.classList.toggle('scrolled', frame.scrollTop > TH);
    onScroll();
    frame.addEventListener('scroll', onScroll, { passive: true });

    const navToggle = header.querySelector('.mobile-nav-toggle');
    if (navToggle) {
        navToggle.addEventListener('click', () => {
            const isActive = document.body.classList.contains('mobile-nav-active');
            header.classList.toggle('nav-open', !isActive);
//         	header.classList.toggle('nav-open');
        });
    }

    frame.addEventListener('scroll', () => AOS.refresh());
    AOS.init({ once: false, duration: 800, easing: 'ease-out' });
});


document.addEventListener("DOMContentLoaded", function () {
	  const frame = document.querySelector(".mobile-frame");
	  const links = document.querySelectorAll("#footer-navmenu a");
	  const sections = Array.from(document.querySelectorAll("section[id]"));
	  const homeLink = document.querySelector('#footer-navmenu a[href="/main#home"]');

	  // === 현재 페이지가 /main 인지 판별 ===
	  const isMainPage = window.location.pathname.includes("/main");

	  // 클릭 시 부드럽게 이동
	  links.forEach(link => {
	    link.addEventListener("click", e => {
	      const href = link.getAttribute("href");
	      const [page, hash] = href.split("#");

	      // === /main 페이지일 때만 scrollIntoView 작동 ===
	      if (isMainPage && hash) {
	        e.preventDefault();
	        const targetSection = document.getElementById(hash);
	        if (targetSection) {
	          targetSection.scrollIntoView({ behavior: "smooth", block: "start" });
	        }
	      } else if (!isMainPage && page.includes("/main")) {
	        // 다른 페이지(예: /mber) → /main으로 이동
	        window.location.href = href;
	      }
	      // /mber 등은 그냥 이동 (기존 동작)
	    });
	  });

	  // === /main 페이지일 때만 IntersectionObserver 활성화 ===
	  if (isMainPage) {
	    const observer = new IntersectionObserver(function (entries) {
	      const visible = entries
	        .filter(e => e.isIntersecting)
	        .sort((a, b) => a.boundingClientRect.top - b.boundingClientRect.top);

	      if (frame && frame.scrollTop < 150) {
	        links.forEach(a => a.classList.remove("active"));
	        if (homeLink) homeLink.classList.add("active");
	        return;
	      }

	      if (visible.length > 0) {
	        const id = visible[0].target.getAttribute("id");
	        links.forEach(a => a.classList.remove("active"));

	        if (["testimonials", "hero", "mainBanner"].includes(id)) {
	          if (homeLink) homeLink.classList.add("active");
	        } else {
	          const selector = `#footer-navmenu a[href="/main#\${id}"]`;
	          const link = document.querySelector(selector);
	          if (link) link.classList.add("active");
	        }
	      }
	    }, {
	      root: frame || null,
	      threshold: 0.2,
	      rootMargin: "-10% 0px -45% 0px"
	    });

	    sections.forEach(section => observer.observe(section));
	    links.forEach(a => a.classList.remove("active"));
	    if (homeLink) homeLink.classList.add("active");
	  }

	  // frame 스크롤 시 AOS 갱신
	  if (frame) frame.addEventListener("scroll", () => AOS.refresh());
	});
</script>

<!-- 나혜선 추가 시작 -->
<script>
//버튼으로 최소화 처리
function handleClick(){
	document.querySelector("#chatBox").style.display="none";
}

/* function handleClick2(){
	document.querySelector("#chatBox").style.display="block";
} */

document.addEventListener("DOMContentLoaded",function(){
   
    let chatWindow = null;  // 빈 객체
   const chatUrl = "/chat";

   const messageBtn = document.querySelector(".chatBtn");
   const messageBox = document.getElementById("chatBox");
    const dragHandle = document.getElementById("dragHandle");
   
   messageBtn.addEventListener("click",function(){  //메신저 버튼을 클릭하면

     //토글이용 : 열려 있으면 닫기, 닫혀 있으면 열기
     if(messageBox.style.display=="none" || messageBox.style.display==""){
    	 messageBox.style.display="block";
    	 
     if(!messageBox.style.left || messageBox.style.left=="auto"){
    	 messageBox.style.left = (window.innerWidth - 811) + "px";
         messageBox.style.top = (window.innerHeight - 730) + "px";
     }	     	 
     }else{
    	 messageBox.style.display="none";
     }

     const iframe = document.getElementById("chatFrame");
     
     if(!iframe.src) iframe.src  = chatUrl;
     document.getElementById("chatBox").style.display="block";     
   }); //메신저 버튼 
   
   
   //채팅창 위치 옮기기 위해
   let possibledrag = false, offsetX = 0, offsetY=0;   //offsetX : 가로,  offsetY: 세로
   let pending = false;
   
   dragHandle.addEventListener("mousedown",(e)=>{  //마우스 버튼을 누르면
      if(e.target.tagName !== "IFRAME"){   //채팅창 테두리 또는 배경 클릭 시에만 드래그 가능하게 함
        possibledrag = true;
        messageBox.classList.add("dragging");
        
       const position = messageBox.getBoundingClientRect(); //BoundingClientRect은 내장된 api 메서드
       messageBox.style.left = position.left + "px";
       messageBox.style.top = position.top + "px";
       messageBox.style.right = "auto";
       messageBox.style.bottom = "auto";
             
        offsetX = e.clientX - position.left;
        offsetY = e.clientY - position.top;
        
        e.preventDefault(); //텍스트 선택 방지
      }
   });

    document.addEventListener("mousemove",(e)=>{  //마우스가 움직일때마다
       if(!possibledrag || pending) return;
        pending = true;
        messageBox.classList.remove("dragging");
        
        requestAnimationFrame(()=>{
         messageBox.style.left = (e.clientX - offsetX) + "px";
         messageBox.style.top = (e.clientY - offsetY) + "px";
         pending=false;
        });
      });

       document.addEventListener("mouseup",()=>{  //마우스 버튼 클릭을 떼면
         possibledrag=false;
       })        
}); //전체 끝

window.addEventListener("message",(event)=>{
  const box = document.querySelector("#chatBox");

  if(event.data.action=="closeChat"){  //chat.jsp로부터 상태값 받음
	  console.log("message event:", event.data);
      box.style.display="none";
   }  
  
   if(event.data.action=="openChat"){
	   box.style.display="block";
   }
  
});
</script>
<!-- 나혜선 추가 끝 -->


</body>
</html>
