<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!-- JPS로 출력하는거. (미완성이니까 참고만) -->
<%@ page language="java" contentType="text/html; charset=UTF-8" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>
<%@ include file="../include/header.jsp"%>
<script src="/js/jquery-3.6.0.js"></script>
<!-- 캘린더 사용 -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/6.1.19/index.min.js'></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/6.1.19/index.global.min.js"></script>
<!-- 캘린더 사용끝 -->
<!-- 민원에서 사용 -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdn.ckeditor.com/ckeditor5/41.2.0/classic/ckeditor.js"></script>
<!-- 민원에서 사용끝 -->


<!-- 캘린더 스타일 지정 -->
<style>
/*날짜 숫자 색상*/
.fc-daygrid-day-number{
    color:gray;
}
/*요일 헤더 색상*/
.fc-col-header-cell-cushion {
     color: black;
}
/*오늘 날짜 배경색*/
 .fc-day-today{
    background-color: beige;
 }
/*이벤트 일정 스타일*/
.fc-event {
  background-color: plum;
  color: blueviolet;
  border-radius: 3px;
}
  /* Week number 색상 */
  .fc .fc-daygrid-week-number {
    color: #888888;
  }
<!-- 민원ck에디터 -->
</style>

<style>
.ck.ck-editor {
    max-width: 300px;
}
.ck-editor__editable {
    min-height: 100px;
}
 
</style>

<script>
////////////////////////////////////////////////캘린더의 script 영역////////////////////////////////////////////////
  document.addEventListener("DOMContentLoaded",function(){
   //캘린더 
   //캘린더 헤더 옵션
   const headerToolbar = {
         left: 'prevYear,prev,next,nextYear today',
         center: 'title',
         right: 'dayGridMonth,dayGridWeek,timeGridDay'
     }
     // 캘린더 생성 옵션(참공)
     const calendarOption = {
         height: '700px', // calendar 높이 설정
         expandRows: true, // 화면에 맞게 높이 재설정
         slotMinTime: '09:00', // Day 캘린더 시작 시간
         slotMaxTime: '18:00', // Day 캘린더 종료 시간
         // 맨 위 헤더 지정
         headerToolbar: headerToolbar,
         initialView: 'dayGridMonth',  // default: dayGridMonth 'dayGridWeek', 'timeGridDay', 'listWeek'
         locale: 'kr',        // 언어 설정
         selectable: true,    // 영역 선택
         selectMirror: true,  // 오직 TimeGrid view에만 적용됨, default false
         navLinks: true,      // 날짜,WeekNumber 클릭 여부, default false
         weekNumbers: true,   // WeekNumber 출력여부, default false
         editable: true,      // event(일정) 
         dayMaxEventRows: true,  // Row 높이보다 많으면 +숫자 more 링크 보임!
         nowIndicator: true,
         events:function(info,successCallback,failureCallback){
           const url = "/fx/listAjax";
        	 $.ajax({
                 url:url,
                 contentType : "application/json",
                 type: 'get',
                 dataType: 'json',
                 success: function(param){
                    var events = [];
                    console.log("param : ", param);
                    $.each(param, function (index, data){
                        console.log("data : ", data);
                        //구분(시설,커뮤니티,일정)에 따라 색상 다르게 반영
                      let bgColor = "";
                      let texColor="white";
                      switch(data.fxIem){
                        case "커뮤니티":
                             bgColor="lightblue";
                             break;
                           
                        case "개인일정":
                             bgColor="lightgreen";
                             texColor="black";
                             break;
                      }
                        events.push({
                            id:data.schdulSn,
                            title:data.fxSj,
                            start:data.fxBeginDt,
                            end:data.fxEndDt,
                            allDay:false,
                            backgroundColor:bgColor, //배경색
                            textColor:texColor,    //글자색
                            extendedProps:{  //추가 데이터
                               empId:data.empId,
                               fxIem:data.fxIem,
                               fxCn:data.fxCn,
                               fxPlace:data.fxPlace
                            }	
                        });
                    })
                    successCallback(events);
                }
        	 });  
         }	 
     }
     // 캘린더 생성
    const calendarEl = document.querySelector("#calendar");
    const calendar = new FullCalendar.Calendar(calendarEl, calendarOption);
     // 캘린더 그리기
     calendar.render();
     // 캘린더 이벤트 등록
     calendar.on("eventAdd", info => console.log("Add:", info));
     calendar.on("eventChange", info => console.log("Change:", info));
     calendar.on("eventRemove", info => console.log("Remove:", info));
     calendar.on("eventClick", info => {
         console.log("eClick:", info);
         console.log('Event: ', info.event.extendedProps);
         console.log('Coordinates: ', info.jsEvent);
         console.log('View: ', info.view);
     });
     calendar.on("eventMouseEnter", info => console.log("eEnter:", info));
     calendar.on("eventMouseLeave", info => console.log("eLeave:", info));
     calendar.on("dateClick", info => console.log("dateClick:", info));
     calendar.on("select", info => {
         console.log("체크:", info);
     document.querySelector("#fxBeginDt").value = info.startStr;
     document.querySelector("#fxEndDt").value = info.endStr;
    fxBeginDt.value = info.startStr;   //달력화면에서 날짜 클릭 or 드래크해서 일정 영역을 선택했을때 실행
    fxEndDt.value = info.endStr;
         $("#scheduleModal").modal('show');
   });
    //데이터값
    const modalBtn =  document.querySelector("#registerBtn");
    modalBtn.addEventListener("click",function(e){   //일정 추가 버튼을 누르면
          e.preventDefault();
        $("#scheduleModal").modal('show');
    });
    const saveBtnn = document.querySelector("#saveBtn");
    saveBtnn.addEventListener("click",function(){  //저장 버튼을 누르면
       const schdulSn = document.querySelector("#schdulSn").value;
       const empId  = document.querySelector("#empId").value;
       const fxSj = document.querySelector("#fxSj").value;
       const fxIem = document.querySelector("#fxIem").value;
       const fxBeginDt = document.querySelector("#fxBeginDt").value;
       const fxEndDt = document.querySelector("#fxEndDt").value;
       const fxCn = document.querySelector("#fxCn").value;
       const fxPlace = document.querySelector("#fxPlace").value;
       let nhs={
         "schdulSn":schdulSn,
         "empId":empId,
         "fxSj":fxSj,
         "fxIem":fxIem,
         "fxBeginDt":fxBeginDt,
         "fxEndDt":fxEndDt,
         "fxCn":fxCn,
         "fxPlace":fxPlace
       }
       //일정 등록 요청
      fetch("/fx/insert",{
        method:"post",
        headers:{'Content-Type':"application/json;charset=utf-8"},
        body:JSON.stringify(nhs)
      })
      .then(response=>{
        return response.text();
      })
      .then(result=>{
        console.log("result :",result);

        if(result=="success"){
          alert("등록이 완료되었습니다.");
          $("#scheduleModal").modal('hide');  //모달 닫기
          $("#scheduleForm")[0].reset();
          calendar.refetchEvents();
        }else{
          alert("등록에 실패했습니다.")
        }
      })
      .catch(error=>{
        console.log("error : ",error);
      })
    })
   //일정 클릭 시 상세보기
   calendar.on("eventClick",function(info){  //info:fullcalendar가 event를 클릭했을때 자동으로 전달해주는 객체
     console.log("info.event: ",info.event);
      const period = info.event;
     //수정모달 일련번호 넣기
     $("#detailschdulSn").val(period.id);
      //이전 모달 내용 가지고오기
       $("#detailempId").val(period.extendedProps.empId);
       $("#detailfxSj").val(period.title);
       $("#detailfxIem").val(period.extendedProps.fxIem);
       $("#detailfxBeginDt").val(period.startStr.substring(0,16));
       $("#detailfxEndDt").val(period.endStr.substring(0,16));
       $("#detailfxCn").val(period.extendedProps.fxCn);
       $("#detailfxPlace").val(period.extendedProps.fxPlace);
       //모달 띄우기
       $("#detailModal").modal('show');
   });
    const modifyBtn =  document.querySelector("#detailsaveBtn");
    modifyBtn.addEventListener("click",function(){  //수정 버튼을 누르면
       const schdulSn = document.querySelector("#detailschdulSn").value;
       const empId  = document.querySelector("#detailempId").value;
       const fxSj = document.querySelector("#detailfxSj").value;
       const fxIem = document.querySelector("#detailfxIem").value;
       const fxBeginDt = document.querySelector("#detailfxBeginDt").value;
       const fxEndDt = document.querySelector("#detailfxEndDt").value;
       const fxCn = document.querySelector("#detailfxCn").value;
       const fxPlace = document.querySelector("#detailfxPlace").value;
       let nhs={
         "schdulSn":schdulSn,
         "empId":empId,
         "fxSj":fxSj,
         "fxIem":fxIem,
         "fxBeginDt":fxBeginDt,
         "fxEndDt":fxEndDt,
         "fxCn":fxCn,
         "fxPlace":fxPlace
       }
        //일정 수정 요청
      fetch("/fx/modify",{
        method:"post",
        headers:{'Content-Type':"application/json;charset=utf-8"},
        body:JSON.stringify(nhs)
      })
      .then(response=>{
        return response.text();
      })
      .then(result=>{
        console.log("result :",result);

        if(result=="success"){
          alert("수정이 완료되었습니다.");
          $("#detailModal").modal('hide');  //모달 닫기
          calendar.refetchEvents();
        }else{
          alert("수정에 실패했습니다.")
        }
      })
      .catch(error=>{
        console.log("error : ",error);
      })
    })
    });
 </script>
<!--/////////////////////////////////////////////// 캘린더의 script 영역 ///////////////////////////////////////////////-->
<!--/////////////////////////////////////////////// 민원의 script 영역 ///////////////////////////////////////////////-->

<script>
document.addEventListener("DOMContentLoaded", () => {
	// 테이블과 폼 요소 캐싱
	const tableBody = document.getElementById("cvplTableBody");			// 민원 리스트 테이블 본문 영역
	const pagingArea = document.getElementById("pagingAreaWrap");		// 페이지네이션 영역
	const form = document.getElementById("searchForm");					// 검색 폼
	const currentPageInput = document.getElementById("currentPage");	// 현재 페이지 hidden input
	const sizeSelect = document.getElementById("sizeSelect");			// 보기 개수
	const mainListWrap = document.getElementById("mainListWrap");		// 리스트/검색 전체 영역
	const detailWrap = document.getElementById("detailWrap");			// 상세+접수 통합 화면 영역
	const detailLeft = document.getElementById("detailLeft");			// 상세 영역
	const detailRight = document.getElementById("detailRight");			// 접수 입력 영역
	// 초기 로딩 시 리스트 자동 조회 (0.3초 지연 후 실행)
	setTimeout(() => loadList(), 300);
	// 페이지당 개수 변경 시 리스트 다시 로드
	sizeSelect.addEventListener("change", () => {
		currentPageInput.value = 1; // 첫 페이지부터
		loadList();
	});
	// 검색 이벤트 등록
	form.addEventListener("submit", e => {
		e.preventDefault();				// 기본 form submit 동작 차단
		currentPageInput.value = 1;		// 검색 시 항상 첫 페이지부터
		loadList();						// 리스트 재조회
	});
	// 초기화 버튼 클릭 시 폼 리셋
	document.getElementById("resetBtn").addEventListener("click", () => {
		form.reset();
		currentPageInput.value = 1;
		loadList();
	});
	// 리스트 데이터 로드 함수
	function loadList() {
		const params = new URLSearchParams(new FormData(form)).toString();
		console.log([...new FormData(form).entries()]);
		// 로딩 표시
		tableBody.innerHTML = `
			<tr>
				<td colspan="7" class="text-center text-muted py-4">
					<div class="spinner-border text-primary" role="status">
						<span class="visually-hidden">Loading...</span>
					</div>
				</td>
			</tr>
		`;
		// 비동기 요청으로 리스트 조회 //List fetch
		fetch("/cvplRcept/listAjax?" + params)
			.then(res => res.json())
			.then(data => {
				renderTable(data.cvplVOList, data.articlePage);			// 민원 리스트 렌더링
				renderPagination(data.articlePage);		// 페이지네이션 갱신
			})
			.catch(err => console.error("민원 리스트 요청 오류:", err));
	}
	// 테이블 렌더링
	function renderTable(list, articlePage) {
		if (!list || list.length == 0) {
			tableBody.innerHTML = `
				<tr>
					<td colspan="7" class="text-center text-muted py-4">해당 조건에 맞는 민원이 없습니다.	</td>
				</tr>`;
			return;
		}
		const fragment = document.createDocumentFragment();
		// 행 생성
		list.forEach((vo, index) => {
			const row = document.createElement("tr");
			// 민원 처리 상태
			const statusText =
				vo.rceptSttus == 0 ? `<span style="color:gray;">대기 중</span>` :
				vo.rceptSttus == 1 ? `<span style="color:orange;">처리 중</span>` :
				`<span style="color:green;">완료</span>
			`;
			// 남은일수 계산
			let remainHtml = "-";
			if (vo.rceptSttus == 2) {
				remainHtml = '-';
			}else if (vo.reqstDt) {
				const requestDate = new Date(vo.reqstDt.substring(0, 10));
				const deadline = new Date(requestDate);
				deadline.setDate(deadline.getDate() + 14);
				const today = new Date();
				const diffTime = deadline.getTime() - today.getTime();
				const remainDays =  Math.floor(diffTime / (1000 * 60 * 60 * 24));
				
				if (remainDays <= 0) {
					remainHtml = `<span style="color:gray;">기한 만료</span>`;
				} else if (remainDays <= 3) {
					remainHtml = `<span style="color:red;">D-\${remainDays}</span>`;
				} else if (remainDays <= 7) {
					remainHtml = `<span style="color:orange;">D-\${remainDays}</span>`;
				} else {
					remainHtml = `<span style="color:green;">D-\${remainDays}</span>`;
				}
			}
			// 상태별 버튼 구성
			let actionBtns = "";
			// 접수 버튼 추가
			if (vo.rceptSttus == 0) {
				actionBtns += `
					<button type="button" class="btn btn-primary btn-sm ms-1 rceptBtn" data-cvplsn="\${vo.cvplSn}">
						접수
					</button>
				`;
			}
			// 종결 버튼 추가
			else if (vo.rceptSttus == 1) {
				actionBtns += `
					<button type="button" class="btn btn-success btn-sm ms-1 endBtn" data-cvplrceptid="\${vo.cvplRceptId}" data-cvplsn="\${vo.cvplSn}">
						종결
					</button>
				`;
			}
			// 상세 버튼 추가
			else if (vo.rceptSttus == 2) {
				actionBtns += `
					<button type="button" class="btn btn-secondary btn-sm ms-1 detailBtn" data-cvplsn="\${vo.cvplSn}">
						상세
					</button>
				`;
			}
			const startIndex = (articlePage.currentPage - 1) * articlePage.size;
			const rowNumber = startIndex + index + 1;
			// 행 내용 채우기
			row.innerHTML = `
				<td>\${rowNumber}</td>
				<td>\${vo.cvplSj}</td>
				<td>\${vo.mberNm || vo.mberId}</td>
				<td>\${vo.reqstDt ? vo.reqstDt.substring(0,10) : '-'}</td>
				<td>\${vo.rceptDt ? vo.rceptDt.substring(0,10) : '-'}</td>
				<td>\${statusText}</td>
				<td>\${remainHtml}</td>
				<td>\${actionBtns}</td>
			`;
			fragment.appendChild(row);
		});
		// 기존 내용 교체
		tableBody.replaceChildren(fragment);
		// 접수 버튼 클릭 시 리스트 숨기고 상세/접수 레이아웃 표시
		tableBody.querySelectorAll(".rceptBtn").forEach(btn => {
			btn.addEventListener("click", () => {
				const cvplSn = btn.dataset.cvplsn;
				mainListWrap.style.display = "none";	// 리스트 숨김
				detailWrap.style.display = "flex";		// 상세/접수 표시
				loadDetailAndForm(cvplSn, false);
			});
		});
		// 종결 버튼 클릭 시 상세와 접수 보기
		tableBody.querySelectorAll(".endBtn").forEach(btn => {
			btn.addEventListener("click", () => {
				mainListWrap.style.display = "none";
				detailWrap.style.display = "flex";
				loadDetailAndForm(btn.dataset.cvplsn, "end");
			});
		});
		// 완료된 민원 상세 버튼 클릭 시
		tableBody.querySelectorAll(".detailBtn").forEach(btn => {
			btn.addEventListener("click", () => {
				mainListWrap.style.display = "none";
				detailWrap.style.display = "flex";
				loadDetailAndForm(btn.dataset.cvplsn, true); // readOnly 모드로 열기
			});
		});
	}
	// 상세 + 접수 레이아웃 로드
	function loadDetailAndForm(cvplSn, readOnly) {
		fetch("/cvplRcept/cvplDetailAjax?cvplSn=" + cvplSn)
			.then(res => res.json())
			.then(data => {
				const cvplVO = data.cvplVO;
				const cvplRceptVO = data.cvplRceptVO;
				console.log("읽기모드? =>", readOnly, typeof readOnly, "상태값:", cvplVO.rceptSttus);
				//왼족 민원 상세
				let fileHtml = "";
				if (cvplVO.fileGroupVO && cvplVO.fileGroupVO.fileDetailVOList && cvplVO.fileGroupVO.fileDetailVOList.length > 0) {
					fileHtml = `
						<p><strong>첨부 이미지:</strong></p>
						<div style="display:flex; gap:10px; flex-wrap:wrap;">
					`;
					cvplVO.fileGroupVO.fileDetailVOList.forEach(file => {
						const fileUrl = "/upload" + file.fileStrelc;
						if (['jpg','jpeg','png','gif','webp'].includes(file.fileExtsn?.toLowerCase())) {
							fileHtml += `<img src="\${fileUrl}" alt="\${file.fileOrginlNm || ''}" 
								style="width:100px;height:100px;object-fit:cover;border:1px solid #ccc;border-radius:5px;">`;
						}
					});
					fileHtml += `</div>`;
				} else {
					fileHtml = `<p class="text-muted">첨부 이미지가 없습니다.</p>`;
				}
				detailLeft.innerHTML = `
					<h5 class="fw-bold mb-3">\${cvplVO.cvplSj}</h5>
					<p><strong>작성자:</strong> \${cvplVO.mberNm || cvplVO.mberId}</p>
					<p><strong>요청일자:</strong> \${cvplVO.reqstDt ? cvplVO.reqstDt.substring(0,10) : '-'}</p>
					<p><strong>내용:</strong></p>
					<div class="border rounded p-3 bg-light mb-3">\${cvplVO.cvplCn}</div>
					<p><strong>접수일자:</strong> \${cvplVO.rceptDt ? cvplVO.rceptDt.substring(0,10) : '-'}</p><hr>
					<p>\${fileHtml}</p>
				`;
				// 오른쪽(접수버튼 & 종결버튼)(작성 & 읽기)
				if (readOnly) {
					let rceptFileHtml = "";
					if (cvplRceptVO && cvplRceptVO.fileGroupVO && cvplRceptVO.fileGroupVO.fileDetailVOList.length > 0) {
						rceptFileHtml = cvplRceptVO.fileGroupVO.fileDetailVOList.map(f => 
							`<img src="/upload\${f.fileStrelc}" style="width:100px;height:100px;object-fit:cover;border:1px solid #ccc;border-radius:5px;">`
						).join('');
					} else {
						rceptFileHtml = `<p class="text-muted">첨부 없음</p>`;
					}
					const isCompleted = String(cvplVO.rceptSttus) === "2";	// 완료 상태
					const isProcessing = String(cvplVO.rceptSttus) === "1";	// 처리중 상태
					let endButtonHtml = "";
					if (readOnly == "end") {
						endButtonHtml = `<button type="button" class="btn btn-success" id="endBtn" data-cvplrceptid="\${cvplRceptVO.cvplRceptId}">
							종결
						</button>`;
					}
					detailRight.innerHTML = `
						<h5 class="fw-bold mb-3">접수 내용</h5>
						<div class="border rounded p-3 bg-light mb-3">\${cvplRceptVO.rceptCn}</div>
						<p><strong>접수자:</strong> \${cvplRceptVO.empNm || cvplRceptVO.empId}</p>
						<p><strong>접수일자:</strong> \${cvplRceptVO.rceptDt ? cvplRceptVO.rceptDt.substring(0,10) : '-'}</p>
						<hr>
						<p><strong>처리 첨부파일:</strong></p>
						<div style="display:flex; gap:10px; flex-wrap:wrap;">\${rceptFileHtml}</div>
						<div class="text-end mt-4">
							<button type="button" class="btn btn-secondary" id="cancelBtn">닫기</button>
							\${endButtonHtml}
						</div>
					`;
					//닫기 버튼
					document.getElementById("cancelBtn").addEventListener("click", () => {
						detailWrap.style.display = "none";
						mainListWrap.style.display = "block";
					});
					// 종결 버튼
					const endBtn = document.getElementById("endBtn");
					if(endBtn) {
						endBtn.addEventListener("click", () => {
							const cvplRceptId = cvplRceptVO.cvplRceptId;
							Swal.fire({
								title: "민원을 종결하시겠습니까?",
								icon: "warning",
								showCancelButton: true,
								confirmButtonText: "예",
								cancelButtonText: "아니오"
							}).then(result => {
								if (result.isConfirmed) {
									fetch("/cvplRcept/cvplEnPost", {
										method: "POST",
										headers: {"Content-Type": "application/x-www-form-urlencoded"},
										body: `cvplRceptId=\${cvplRceptId}`
									})
									.then(res => res.text())
									.then(result => {
										if (parseInt(result) > 0) {
											Swal.fire({
												icon: "success",
												title: "민원이 종결되었습니다.",
												timer: 1500,
												showConfirmButton: false
											});
											setTimeout(() => {
												detailWrap.style.display = "none";
												mainListWrap.style.display = "block";
												loadList();
											}, 1500);
										} else {
											Swal.fire({
												icon: "warning",
												title: "종결 실패",
												timer: 1500,
												showConfirmButton: false
											});
										}
									})
									.catch(() => {
										Swal.fire({
											icon: "error",
											title: "서버 오류",
											timer: 1500,
											showConfirmButton: false
										});
									});
								}
							});
						});
					}
					return;
				}
				// 작성모드(false): CKEditor + 파일업로드 활성
				detailRight.innerHTML = `
					<h5 class="fw-bold mb-3">민원 접수</h5>
					<form id="cvplForm" enctype="multipart/form-data">
						<input type="hidden" name="cvplSn" value="\${cvplVO.cvplSn}">
						<textarea id="cvplText" name="rceptCn" rows="5" cols="50" placeholder="처리 내용을 입력하세요."></textarea><br>
						<input type="file" id="cvplFile" name="uploadFiles" multiple accept="image/*"><br>
						<div id="previewArea" style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap;"></div><br>
						<div class="text-end">
							<button type="button" class="btn btn-secondary me-2" id="cancelBtn">취소</button>
							<button type="button" class="btn btn-primary" id="successBtn">접수</button>
						</div>
					</form>
				`;
				//닫기 버튼
				document.getElementById("cancelBtn").addEventListener("click", () => {
					detailWrap.style.display = "none";
					mainListWrap.style.display = "block";
				});
				let cvplEditor;
				ClassicEditor.create(document.querySelector('#cvplText'))
					.then(newEditor => window.cvplEditor = newEditor)
					.catch(error => console.error('Editor error:', error));
				$("#cvplFile").on("change", function() {
					const files = this.files;
					const preview = $("#previewArea");
					preview.empty();
					Array.from(files).forEach(file => {
						const reader = new FileReader();
						reader.onload = e => {
							preview.append($("<img>").attr("src", e.target.result).css({
								width:"100px",height:"100px","object-fit":"cover",border:"1px solid #ccc","border-radius":"5px"
							}));
						};
						reader.readAsDataURL(file);
					});
				});
				//접수 버튼
				$("#successBtn").click(function(e) {
					e.preventDefault();
					const content = window.cvplEditor.getData().trim();
					if (content == "") {
						Swal.fire({ icon:'warning', title:'처리 내용을 입력하세요.', timer:1500, showConfirmButton:false });
						return;
					}
					const formData = new FormData();
					formData.append("cvplSn", cvplVO.cvplSn);
					formData.append("rceptCn", content);
					formData.append("empId", "${sessionScope.emp.empId}");
					const files = $("#cvplFile")[0].files;
					for (let i=0;i<files.length;i++) formData.append("uploadFiles", files[i]);
					$.ajax({
						url:"/cvplRcept/cvplRceptPost",
						type:"POST",
						data:formData,processData:false,contentType:false,
						success:function(result){
							if(parseInt(result)>0){
								Swal.fire({ icon:'success', title:'민원이 접수되었습니다.', timer:1500, showConfirmButton:false });
								setTimeout(()=>{detailWrap.style.display="none";mainListWrap.style.display="block";loadList();},1500);
							}else{
								Swal.fire({ icon:'warning', title:'접수 실패', timer:1500, showConfirmButton:false });
							}
						},
						error:function(){
							Swal.fire({ icon:'error', title:'서버 오류', timer:1500, showConfirmButton:false });
						}
					});
				});
			});
	}
	// 페이지네이션 렌더링
	function renderPagination(articlePage) {
		if (!pagingArea) return;							//페이지 영역 DOM이 없으면 바로 종료 (예외 처리)
		//서버에서 articlePage 객체가 없거나 내부에 pagingArea HTML 코드가 없으면 영역을 비움
		if (!articlePage || !articlePage.pagingArea) {
			pagingArea.innerHTML = "";
			return;
		}
		pagingArea.innerHTML = articlePage.pagingArea;		//서버에서 받은 페이징 HTML(articlePage.pagingArea)을 삽입
		//페이징 영역 내부의 링크 클릭 이벤트를 위임 처리 (a 태그 클릭 시 화면 이동 대신 goPage() 호출)
		pagingArea.onclick = (e) => {
			const target = e.target.closest("a");			// 클릭된 a 태그 탐색
			if (!target) return;							// a 태그가 아니면 무시
			e.preventDefault();								// 기본 링크 이동 방지
			// href 속성에서 currentPage=숫자 패턴 추출
			const href = target.getAttribute("href");
			const match = href.match(/currentPage=(\d+)/);
			if (match) goPage(match[1]);					//정규식으로 추출한 페이지 번호를 goPage()에 전달
		};
	}
	// 페이지 이동 처리
	function goPage(pageNo) {
		document.getElementById("currentPage").value = pageNo;				//선택된 페이지 번호를 hidden input에 반영
		const params = new URLSearchParams(new FormData(form)).toString();	//현재 검색 폼(form)의 모든 데이터(FormData)를 직렬화하여 쿼리스트링으로 변환
		
		//List fetch
		fetch("/cvplRcept/listAjax?" + params)
			.then(res => res.json())
			.then(data => {
				renderTable(data.cvplVOList, data.articlePage);		// 민원 리스트 렌더링
				renderPagination(data.articlePage);	// 페이지네이션 갱신
			})
			.catch(err => console.error("페이지 이동 오류:", err));
	}
});
// 백업용 페이지네이션 함수
function renderPagination(articlePage) {
	setTimeout(() => {
		const pagingArea = document.getElementById("pagingAreaWrap");
		if (!pagingArea) return;
		if (!articlePage || !articlePage.pagingArea) {
			pagingArea.innerHTML = "";
			return;
		}
		const newPagingArea = pagingArea.cloneNode(false);
		newPagingArea.innerHTML = articlePage.pagingArea;
		pagingArea.replaceWith(newPagingArea);
		newPagingArea.addEventListener("click", e => {
			const target = e.target.closest("a");
			if (!target) return;
			e.preventDefault();
			const href = target.getAttribute("href");
			const match = href.match(/currentPage=(\d+)/);
			if (match) goPage(match[1]);
		});
	}, 0);
}
</script>
<!--/////////////////////////////////////////////// 민원의 script 영역 ///////////////////////////////////////////////-->

<!--/////////////////////////////////////////////// 결재관련 script영역 ///////////////////////////////////////////////-->
<script>
	document.addEventListener("DOMContentLoaded", function(){
    document.querySelectorAll(".elctrnsanctnRow").forEach(row=>{
      row.addEventListener("click", function(){
        // console.log("check: this.querySelector('#elctrnsanctnSn').value => ", this.querySelector("#elctrnsanctnSn").value);
        location.href="/elctrnsanctn/getElctrnsanctn?elctrnsanctnSn="+this.querySelector("#elctrnsanctnSn").value;
      })
    })
  })  
</script>
<!--/////////////////////////////////////////////// 결재관련 script영역끝 ///////////////////////////////////////////////-->










<section class="content">
<!--       <div class="container-fluid"> -->
        <!-- Small boxes (Stat box) -->
        <!-- /.row -->
        <!-- Main row -->
        <div class="row">
          <!-- Left col -->
          <section class="col-lg-6 connectedSortable ui-sortable">
            <!-- Custom tabs (Charts with tabs)-->
            <div class="card">
              <div class="card-header ui-sortable-handle" style="cursor: move;">
                <h3 class="card-title">
                  <i class="far fa-calendar-alt"></i>
                </h3>일정</h3>
                <div class="card-tools">
                  <ul class="nav nav-pills ml-auto">
                    <li class="nav-item">
                     <button type="button" id="registerBtn" class="btn btn-warning btn-sm" style="margin-left:30px;"> 일정 추가 </button>
                    </li>
                    <li class="nav-item" style="margin: 0 30px;">
                      <i ><a href="/fx/list" >바로가기 <i class="fas fa-arrow-circle-right" style="margin-left:5px;"></i></a></i>
                    </li>
                    <button type="button" class="close" data-dismiss="modal" aria-label="닫기">
			          <span aria-hidden="true">&times;</span>
			        </button>
<!--                     <li class="nav-item"> -->
<!--                       <a class="nav-link" href="#sales-chart" data-toggle="tab">탭2</a> -->
<!--                     </li> -->
                  </ul>
                </div>
              </div><!-- /.card-header -->
              <div class="card-body">
              <div class="card" style="padding: 3px 2px;"> 
                <div class="tab-content p-0">
                  <!-- Morris chart - Sales -->
                  <div class="card-body pt-0">
              
<!--// body 시작 //-->

  
  
<!-- 실제 화면을 담을 영역 -->

  <div id="Wrapper">
      <div id='calendar'></div>
  </div>
    
    
<!-- 일정 등록 모달 시작 -->

<input type="hidden" id="schdulSn" name="schdulSn" value="${fxVO.schdulSn}" />

<div class="modal fade" id="scheduleModal" tabindex="-1" aria-labelledby="scheduleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">

      <!-- 헤더 -->
      <div class="modal-header">
        <h5 class="modal-title" id="scheduleModalLabel">일정 등록</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="닫기">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <!-- 바디 -->
      <div class="modal-body">
        <form id="scheduleForm">
          <div class="form-group row">
            <label class="col-sm-2 col-form-label">담당자 ID</label>
            <div class="col-sm-10">
              <input type="text" id="empId" name="empId" class="form-control" placeholder="담당자 ID 입력">
            </div>
          </div>

          <div class="form-group row">
            <label class="col-sm-2 col-form-label">제목</label>
            <div class="col-sm-10">
              <input type="text" id="fxSj" name="fxSj" class="form-control" placeholder="제목 입력">
            </div>
          </div>

          <div class="form-group row">
            <label class="col-sm-2 col-form-label">구분</label>
            <div class="col-sm-10">
              <select id="fxIem" name="fxIem" class="form-control">
                <option value="">선택</option>
                <option value="시설">시설</option>
                <option value="커뮤니티">커뮤니티</option>
                <option value="개인일정">개인일정</option>
              </select>
            </div>
          </div>

          <div class="form-group row">
            <label class="col-sm-2 col-form-label">시작일시</label>
            <div class="col-sm-4">
              <input type="datetime-local" id="fxBeginDt" name="fxBeginDt" class="form-control">
            </div>
            <label class="col-sm-2 col-form-label text-right">종료일시</label>
            <div class="col-sm-4">
              <input type="datetime-local" id="fxEndDt" name="fxEndDt" class="form-control">
            </div>
          </div>

          <div class="form-group row">
            <label class="col-sm-2 col-form-label">내용</label>
            <div class="col-sm-10">
              <textarea id="fxCn" name="fxCn" class="form-control" rows="3" placeholder="내용 입력"></textarea>
            </div>
          </div>

          <div class="form-group row">
            <label class="col-sm-2 col-form-label">장소</label>
            <div class="col-sm-10">
              <input type="text" id="fxPlace" name="fxPlace" class="form-control" placeholder="장소 입력">
            </div>
          </div>
        </form>
      </div>

      <!-- 푸터 -->
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" id="saveBtn">저장</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">취소</button>
      </div>

    </div>
  </div>
</div>

<!-- 일정 등록 모달 끝 -->       
    


<!--상세보기 모달 시작-->   

<input type="hidden" id="detailschdulSn" name="detailschdulSn" value="${fxVO.schdulSn}" />

<div class="modal fade" id="detailModal" tabindex="-1" aria-labelledby="detailModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">

      <!-- 헤더 -->
      <div class="modal-header">
        <h5 class="modal-title" id="detailModalLabel">상세 보기</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="닫기">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <!-- 바디 -->
      <div class="modal-body">
        <form id="detailscheduleForm">
          <div class="form-group row">
            <label class="col-sm-2 col-form-label">담당자</label>
            <div class="col-sm-10">
              <input type="text" id="detailempId" name="detailempId" class="form-control">
            </div>
          </div>

          <div class="form-group row">
            <label class="col-sm-2 col-form-label">제목</label>
            <div class="col-sm-10">
              <input type="text" id="detailfxSj" name="detailfxSj" class="form-control" >
            </div>
          </div>

          <div class="form-group row">
            <label class="col-sm-2 col-form-label">구분</label>
            <div class="col-sm-10">
              <select id="detailfxIem" name="detailfxIem" class="form-control">
                <option value="">선택</option>
                <option value="시설">시설</option>
                <option value="커뮤니티">커뮤니티</option>
                <option value="개인일정">개인일정</option>
              </select>
            </div>
          </div>

          <div class="form-group row">
            <label class="col-sm-2 col-form-label">시작일시</label>
            <div class="col-sm-4">
              <input type="datetime-local" id="detailfxBeginDt" name="detailfxBeginDt" class="form-control">
            </div>
            <label class="col-sm-2 col-form-label text-right">종료일시</label>
            <div class="col-sm-4">
              <input type="datetime-local" id="detailfxEndDt" name="detailfxEndDt" class="form-control">
            </div>
          </div>

          <div class="form-group row">
            <label class="col-sm-2 col-form-label">내용</label>
            <div class="col-sm-10">
              <textarea id="detailfxCn" name="detailfxCn" class="form-control" rows="3" ></textarea>
            </div>
          </div>

          <div class="form-group row">
            <label class="col-sm-2 col-form-label">장소</label>
            <div class="col-sm-10">
              <input type="text" id="detailfxPlace" name="detailfxPlace" class="form-control">
            </div>
          </div>
        </form>
      </div>

      <!-- 푸터 -->
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" id="detailsaveBtn">수정</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">취소</button>
      </div>

    </div>
  </div>
</div>



<!--상세보기 모달 끝-->    
              
              </div>
                </div>
                </div>
              </div>
            </div>
            <!-- 투표 바로가기 -->
            <div class="card direct-chat direct-chat-primary">
              <div class="card-header ui-sortable-handle" style="cursor: move;">
                <h3 class="card-title"><i class="fas fa-th mr-1"></i>진행중인 투표</h3>
                <div class="card-tools">
                 
                  <button type="button" class="btn btn-tool" >
                    <i><a href="/vote/voteMtr" >바로가기<i class="fas fa-arrow-circle-right" style="margin-left:5px;"></i></a></i>
                  </button>
               
                </div>
              </div>
              <!-- /.card-header -->
              <div class="card-body">
						<div class="card">
							<div class="card-body">
								<table style="border-collapse: collapse; border: none; width: 100%;">
									<thead>
										<tr>
											<th style="width: 10%; text-align: center;">글번호</th>
											<th style="width: 30%; text-align: center;">제목</th>	
											<th style="width: 15%; text-align: center;">시작시간</th>
											<th style="width: 15%; text-align: center;">마감시간</th>
<!-- 											<th style="width: 10%; text-align: center;">작성자ID</th> -->
											<th style="width: 15%; text-align: center;">상태</th>
										</tr>
									</thead>
									<tbody>



										<c:forEach var="p" items="${articlePage1.content}" varStatus="stat">
											<tr>
												<td style="text-align: center;"><a href="/vote/voteDetail?voteMtrSn=${p.voteMtrSn}">[${p.voteMtrSn}]</a></td>
												<td><a href="/vote/voteDetail?voteMtrSn=${p.voteMtrSn}"><c:out value="${p.mtrSj}" /></a></td>
												<td style="text-align: center;">
													${fn:substring(p.voteBeginDt, 0, 10)}
												</td>
												<td style="text-align: center;">
													${fn:substring(p.voteEndDt, 0, 10)}
												</td>
<!-- 												<td style="text-align: center;"> -->
<%-- 													<c:out value="${p.empId}" /> --%>
<!-- 												</td> -->
												<td style="text-align: center;">
													<!-- 상태 별 색 추가 업데이트 2025-11-01 -->
													<c:choose>
													  <c:when test="${p.stat eq '진행중'}">
													    <span class="badge badge-success">${p.stat}</span>
													  </c:when>
													  <c:when test="${p.stat eq '예정'}">
													    <span class="badge badge-secondary">${p.stat}</span>
													  </c:when>
													  <c:when test="${p.stat eq '마감'}">
													    <span class="badge badge-warning">${p.stat}</span>
													  </c:when>
													  <c:otherwise>
													    <span class="badge badge-light">${p.stat}</span>
													  </c:otherwise>
													</c:choose>
														
												</td>
											</tr>
										</c:forEach>
									</tbody>
								</table>
							</div>

							<div class="card-footer position-relative"
								style="min-height: 48px;">
								<div class="text-center" style="width: 100%;">${articlePage1.pagingArea}</div>
								<a href="/vote/addVotePage" class="btn btn-info btn-sm"
									style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%);">
									등록하기 </a>
							</div>
						</div>
						<!-- 카드 끝 -->




                <!-- Contacts are loaded here -->
                
                <div class="direct-chat-contacts">
                  <ul class="contacts-list">
                    <li>
                      <a href="#">
                        <img class="contacts-list-img" src="dist/img/user1-128x128.jpg" alt="User Avatar">

                        <div class="contacts-list-info">
                          <span class="contacts-list-name">
                            Count Dracula
                            <small class="contacts-list-date float-right">2/28/2015</small>
                          </span>
                          <span class="contacts-list-msg">How have you been? I was...</span>
                        </div>
                        <!-- /.contacts-list-info -->
                      </a>
                    </li>
                    <!-- End Contact Item -->
                    <li>
                      <a href="#">
                        <img class="contacts-list-img" src="dist/img/user7-128x128.jpg" alt="User Avatar">

                        <div class="contacts-list-info">
                          <span class="contacts-list-name">
                            Sarah Doe
                            <small class="contacts-list-date float-right">2/23/2015</small>
                          </span>
                          <span class="contacts-list-msg">I will be waiting for...</span>
                        </div>
                        <!-- /.contacts-list-info -->
                      </a>
                    </li>
                    <!-- End Contact Item -->
                    <li>
                      <a href="#">
                        <img class="contacts-list-img" src="dist/img/user3-128x128.jpg" alt="User Avatar">

                        <div class="contacts-list-info">
                          <span class="contacts-list-name">
                            Nadia Jolie
                            <small class="contacts-list-date float-right">2/20/2015</small>
                          </span>
                          <span class="contacts-list-msg">I'll call you back at...</span>
                        </div>
                        <!-- /.contacts-list-info -->
                      </a>
                    </li>
                    <!-- End Contact Item -->
                    <li>
                      <a href="#">
                        <img class="contacts-list-img" src="dist/img/user5-128x128.jpg" alt="User Avatar">

                        <div class="contacts-list-info">
                          <span class="contacts-list-name">
                            Nora S. Vans
                            <small class="contacts-list-date float-right">2/10/2015</small>
                          </span>
                          <span class="contacts-list-msg">Where is your new...</span>
                        </div>
                        <!-- /.contacts-list-info -->
                      </a>
                    </li>
                    <!-- End Contact Item -->
                    <li>
                      <a href="#">
                        <img class="contacts-list-img" src="dist/img/user6-128x128.jpg" alt="User Avatar">

                        <div class="contacts-list-info">
                          <span class="contacts-list-name">
                            John K.
                            <small class="contacts-list-date float-right">1/27/2015</small>
                          </span>
                          <span class="contacts-list-msg">Can I take a look at...</span>
                        </div>
                        <!-- /.contacts-list-info -->
                      </a>
                    </li>
                    <!-- End Contact Item -->
                    <li>
                      <a href="#">
                        <img class="contacts-list-img" src="dist/img/user8-128x128.jpg" alt="User Avatar">

                        <div class="contacts-list-info">
                          <span class="contacts-list-name">
                            Kenneth M.
                            <small class="contacts-list-date float-right">1/4/2015</small>
                          </span>
                          <span class="contacts-list-msg">Never mind I found...</span>
                        </div>
                        <!-- /.contacts-list-info -->
                      </a>
                    </li>
                    <!-- End Contact Item -->
                  </ul>
                  <!-- /.contacts-list -->
                </div>
                <!-- /.direct-chat-pane -->
              </div>
              <!-- /.card-body -->
            </div><div class="card" style="position: relative; left: 0px; top: 0px;">
              <div class="card-header ui-sortable-handle" style="cursor: move;">
                <h3 class="card-title">
                  <i class="ion ion-clipboard mr-1"></i>
                  To Do List
                </h3>

                <div class="card-tools">
                  <ul class="pagination pagination-sm">
                    <li class="page-item"><a href="#" class="page-link">«</a></li>
                    <li class="page-item"><a href="#" class="page-link">1</a></li>
                    <li class="page-item"><a href="#" class="page-link">2</a></li>
                    <li class="page-item"><a href="#" class="page-link">3</a></li>
                    <li class="page-item"><a href="#" class="page-link">»</a></li>
                  </ul>
                </div>
              </div>
              <!-- /.card-header -->
              <div class="card-body">
                <ul class="todo-list ui-sortable" data-widget="todo-list">
                  <li>
                    <!-- drag handle -->
                    <span class="handle ui-sortable-handle">
                      <i class="fas fa-ellipsis-v"></i>
                      <i class="fas fa-ellipsis-v"></i>
                    </span>
                    <!-- checkbox -->
                    <div class="icheck-primary d-inline ml-2">
                      <input type="checkbox" value="" name="todo1" id="todoCheck1">
                      <label for="todoCheck1"></label>
                    </div>
                    <!-- todo text -->
                    <span class="text">Design a nice theme</span>
                    <!-- Emphasis label -->
                    <small class="badge badge-danger"><i class="far fa-clock"></i> 2 mins</small>
                    <!-- General tools such as edit or delete-->
                    <div class="tools">
                      <i class="fas fa-edit"></i>
                      <i class="fas fa-trash-o"></i>
                    </div>
                  </li>
                  <li class="done">
                    <span class="handle ui-sortable-handle">
                      <i class="fas fa-ellipsis-v"></i>
                      <i class="fas fa-ellipsis-v"></i>
                    </span>
                    <div class="icheck-primary d-inline ml-2">
                      <input type="checkbox" value="" name="todo2" id="todoCheck2" checked="">
                      <label for="todoCheck2"></label>
                    </div>
                    <span class="text">Make the theme responsive</span>
                    <small class="badge badge-info"><i class="far fa-clock"></i> 4 hours</small>
                    <div class="tools">
                      <i class="fas fa-edit"></i>
                      <i class="fas fa-trash-o"></i>
                    </div>
                  </li>
                  <li>
                    <span class="handle ui-sortable-handle">
                      <i class="fas fa-ellipsis-v"></i>
                      <i class="fas fa-ellipsis-v"></i>
                    </span>
                    <div class="icheck-primary d-inline ml-2">
                      <input type="checkbox" value="" name="todo3" id="todoCheck3">
                      <label for="todoCheck3"></label>
                    </div>
                    <span class="text">Let theme shine like a star</span>
                    <small class="badge badge-warning"><i class="far fa-clock"></i> 1 day</small>
                    <div class="tools">
                      <i class="fas fa-edit"></i>
                      <i class="fas fa-trash-o"></i>
                    </div>
                  </li>
                  <li>
                    <span class="handle ui-sortable-handle">
                      <i class="fas fa-ellipsis-v"></i>
                      <i class="fas fa-ellipsis-v"></i>
                    </span>
                    <div class="icheck-primary d-inline ml-2">
                      <input type="checkbox" value="" name="todo4" id="todoCheck4">
                      <label for="todoCheck4"></label>
                    </div>
                    <span class="text">Let theme shine like a star</span>
                    <small class="badge badge-success"><i class="far fa-clock"></i> 3 days</small>
                    <div class="tools">
                      <i class="fas fa-edit"></i>
                      <i class="fas fa-trash-o"></i>
                    </div>
                  </li>
                  <li>
                    <span class="handle ui-sortable-handle">
                      <i class="fas fa-ellipsis-v"></i>
                      <i class="fas fa-ellipsis-v"></i>
                    </span>
                    <div class="icheck-primary d-inline ml-2">
                      <input type="checkbox" value="" name="todo5" id="todoCheck5">
                      <label for="todoCheck5"></label>
                    </div>
                    <span class="text">Check your messages and notifications</span>
                    <small class="badge badge-primary"><i class="far fa-clock"></i> 1 week</small>
                    <div class="tools">
                      <i class="fas fa-edit"></i>
                      <i class="fas fa-trash-o"></i>
                    </div>
                  </li>
                  <li>
                    <span class="handle ui-sortable-handle">
                      <i class="fas fa-ellipsis-v"></i>
                      <i class="fas fa-ellipsis-v"></i>
                    </span>
                    <div class="icheck-primary d-inline ml-2">
                      <input type="checkbox" value="" name="todo6" id="todoCheck6">
                      <label for="todoCheck6"></label>
                    </div>
                    <span class="text">Let theme shine like a star</span>
                    <small class="badge badge-secondary"><i class="far fa-clock"></i> 1 month</small>
                    <div class="tools">
                      <i class="fas fa-edit"></i>
                      <i class="fas fa-trash-o"></i>
                    </div>
                  </li>
                </ul>
              </div>
              <!-- /.card-body -->
              <div class="card-footer clearfix">
                <button type="button" class="btn btn-primary float-right"><i class="fas fa-plus"></i> Add item</button>
              </div>
            </div>
            <!--/.direct-chat -->

            <!-- TO DO List -->
            
            <!-- /.card -->
          </section>
          <section class="col-lg-6 connectedSortable ui-s ortable">

            <div class="card bg-gradient-primary">
            </div>
            <!-- /.card -->

            <!-- solid sales graph -->
            <div class="card bg-light">
              <div class="card-header border-0 ui-sortable-handle" style="cursor: move;">
                <h3 class="card-title">
                  <i class="fas fa-th mr-1"></i>
                  민원관리
                </h3>
                <div class="card-tools">
                  <a href="/cvplRcept/list" class="small-box-footer">민원관리 바로가기<i class="fas fa-arrow-circle-right" style="margin-left:10px;"></i></a>
                </div>
              </div>
              <div class="card" style="padding: 10px 15px;">
              <div>
<div id="mainListWrap">
		<form id="searchForm" action="/cvplRcept/list" method="get" class="row g-2 align-items-end">
			<input type="hidden" name="currentPage" id="currentPage" value="${param.currentPage != null ? param.currentPage : 1}">
		</form>
<table style="border-collapse: collapse; border: none; width: 100%; ">
	<thead class="table-darkr">
		<tr>
			<th>번호</th>
			<th>제목</th>
			<th>작성자</th>
			<th>요청일자</th>
			<th>접수일자</th>
			<th>처리상태</th>
			<th>남은 기간</th>
			<th>관리</th>
		</tr>
	</thead>
	<tbody id="cvplTableBody">
		<tr>
			<td colspan="7" class="text-center text-muted py-4">해당 조건에 맞는 민원이 없습니다.</td>
		</tr>
	</tbody>
</table>

<!-- 페이지네이션 -->
<div id="pagingAreaWrap" class="card-footer clearfix">
	${articlePage.pagingArea}
</div>
</div>
</div>
<!-- 상세/접수 통합 영역 -->
<div id="detailWrap" style="display:none; gap:30px;">
	<div id="detailLeft" style="flex:1; border-right:1px solid #ccc; padding-right:20px;"></div>
	<div id="detailRight" style="flex:1; padding-left:20px;"></div>
</div>
</div>
              <div class="card-footer bg-transparent">
                <div class="row">

                </div>
              </div>
            </div>

            <div class="card bg-light">
              <div class="card-header border-0 ui-sortable-handle" style="cursor: move;">
              
                <h3 class="card-title d-flex align-items-center">
  <i class="far fa-calendar-alt mr-2"></i>
  <span class="mr-2">결재</span>
                <c:set var="rejectCnt" value="0" />
					<c:set var="pendingCnt" value="0" />
					
					<c:forEach var="vo" items="${articlePage2.content}">
					  <c:choose>
					    <c:when test="${vo.totSanctnStts eq '반려'}">
					      <c:set var="rejectCnt" value="${rejectCnt + 1}" />
					    </c:when>
					    <c:when test="${vo.totSanctnStts eq '미결'}">
					      <c:set var="pendingCnt" value="${pendingCnt + 1}" />
					    </c:when>
					  </c:choose>
					</c:forEach>
					  <span class="badge badge-danger ml-2">반려 ${rejectCnt}</span>
					  <span class="badge badge-warning ml-2">미결 ${pendingCnt}</span>
					</h3>
            	<div class="card-tools">
                  <a href="/elctrnsanctn/getElctrnsanctnList" class="small-box-footer">결재관리 바로가기<i class="fas fa-arrow-circle-right" style="margin-left:10px;"></i></a>
                </div>
              </div>
              
              <div class="card bg-white" style="padding 15px; 10px;">
              <div class="card-body pt-0">
                <div id="결재관리" style="width: 100%">
                <ul class="list-unstyled"><li class="show">
                <div class="datepicker"><div class="datepicker-days" style="">
                
                <table style="border-collapse: collapse; border: none; width: 100%; ">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>분류</th>
                      <th>제목</th>
                      <th>등록일시</th>
                      <th>기안일시</th>
                      <th>기안상태</th>
                      <th>결재상태</th>
                    </tr>
                  </thead>
                  <tbody>
                  	<c:forEach var="elctrnsanctnVO" items="${articlePage2.content}">
                  		<tr class="elctrnsanctnRow">
	                      <td>${elctrnsanctnVO.rnum}
                            <input type="hidden" id="elctrnsanctnSn" value="${elctrnsanctnVO.elctrnsanctnSn}">
                        </td>
	                      <td>${elctrnsanctnVO.drftDocVO.elctrnsanctnManageVO.sanctnSecode }/${elctrnsanctnVO.drftDocVO.drftDocNm}</td>
	                      <td>${elctrnsanctnVO.drftSj }</td>
	                      <td>
	                      	<fmt:formatDate value="${elctrnsanctnVO.creatDt}" pattern="yyyy-MM-dd" />	                      
	                      </td>
	                      <td>
	                      	<fmt:formatDate value="${elctrnsanctnVO.drftDt}" pattern="yyyy-MM-dd" /> 
	                      </td>
	                      <td>
	                      	<c:choose>
		                      	<c:when test="${elctrnsanctnVO.drftTmprstreStts eq '임시저장'}">
			                      	<span class="badge badge-success">
			                      		${elctrnsanctnVO.drftTmprstreStts}
			                      	</span>
		                      	</c:when>
		                      	<c:when test="${elctrnsanctnVO.drftTmprstreStts eq '기안완료'}">
			                      	<span class="badge badge-primary">
			                      		${elctrnsanctnVO.drftTmprstreStts}
			                      	</span>
		                      	</c:when>
		                      	<c:when test="${elctrnsanctnVO.drftTmprstreStts eq '기안완료'}">
			                      	<span class="badge badge-light">
			                      		${elctrnsanctnVO.drftTmprstreStts}
			                      	</span>
		                      	</c:when>
		                      </c:choose>
	                      </td>
	                      <td>
	                      	<c:choose>
		                      	<c:when test="${elctrnsanctnVO.totSanctnStts eq '미결'}">
			                      	<span class="badge badge-warning">
			                      		${elctrnsanctnVO.totSanctnStts}
			                      	</span>
		                      	</c:when>
		                      	<c:when test="${elctrnsanctnVO.totSanctnStts eq '반려'}">
			                      	<span class="badge badge-danger">
			                      		${elctrnsanctnVO.totSanctnStts}
			                      	</span>
		                      	</c:when>
		                      	<c:when test="${elctrnsanctnVO.totSanctnStts eq '결재 완료'}">
			                      	<span class="badge badge-primary">
			                      		${elctrnsanctnVO.totSanctnStts}
			                      	</span>
		                      	</c:when>
		                      	<c:when test="${elctrnsanctnVO.totSanctnStts eq '진행중'}">
			                      	<span class="badge badge-success">
			                      		${elctrnsanctnVO.totSanctnStts}
			                      	</span>
		                      	</c:when>
		                      </c:choose>
	                      	
	                      </td>
	                    </tr>
                  	</c:forEach>
                  </tbody>
                </table>
              </div>
              <!-- /.card-body -->
              <div class="card-footer position-relative" style="min-height: 48px;">
				<div class="text-center" style="width: 100%;">${articlePage2.pagingArea}</div>
				<a href="/elctrnsanctn/postElctrnsanctn"
				 class="btn btn-info btn-sm"	
				 style="position: absolute; right: 10px; top: 50%; 
				 transform: translateY(-50%);">	등록하기 </a>
			</div>
            </div>
                </table>
                </div>
                </ul>
                </div>
                </div>
              </div>
              <!-- /.card-body -->
            </div>
            <!-- /.card -->
          </section>
          <!-- right col -->
        </div>
        <!-- /.row (main row) -->
      </div><!-- /.container-fluid -->
      </div>
    </section>


















 <%@ include file="../include/footer.jsp"%>