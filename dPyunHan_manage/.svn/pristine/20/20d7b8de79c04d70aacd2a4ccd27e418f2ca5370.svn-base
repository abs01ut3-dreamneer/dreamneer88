<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.mapper.BidPblancMapper">
	
	<sql id="where">
		<if test="keyword != null and keyword != ''">
    		and (BID_SJ like '%' || #{keyword} || '%')
    	</if>
	</sql>
	
	<insert id="postBidPblanc" parameterType="bidPblancVO">
		<selectKey resultType="int" order="BEFORE" keyProperty="bidPblancSn">
			SELECT NVL(MAX(BID_PBLANC_SN), 0)+1 FROM BID_PBLANC
		</selectKey>
		INSERT INTO BID_PBLANC (
			BID_PBLANC_SN,
			BID_SJ,
			SCSB_MTH,
			BID_CN,
			PBLANC_DT,
			BID_CLOS_DT,
			BID_STTUS,
			ELCTRNSANCTN_SN,
			CDLT_PRESENTN_AT,
			ACMSLTPROOF_PRESENTN_AT,
			FILE_GROUP_SN,
			SPTDC_AT,
			SPTDC_DT,
			SPTDC_PLACE
			, BID_GTN_RT
		) VALUES (
			#{bidPblancSn},
			#{bidSj},
			#{scsbMth},
			#{bidCn},
			SYSDATE,
			#{bidClosDt},
			NULLIF(#{bidSttus}, 0),
			NULLIF(#{elctrnsanctnSn}, 0),
			#{cdltPresentnAt},
			#{acmsltproofPresentnAt},
			#{fileGroupSn},
			#{sptdcAt},
			#{sptdcDt},
			#{sptdcPlace},
			#{bidGtnRt}
		)
	</insert>
	
	<select id="getTotal" resultType="int" parameterType="hashMap">
			select count(*)
				from BID_PBLANC
				where 1 = 1
				<include refid="where"></include>
	</select>
	
	<select id="getBidPblancList" resultType="bidPblancVO" parameterType="hashMap">
		WITH T AS(
		    SELECT ROWNUM RNUM,
		    	   f.bid_pblanc_sn,
		           f.bid_sj,
		           f.scsb_mth,
		           f.bid_cn,
		           f.pblanc_dt,
		           f.BID_CLOS_DT,
		           f.bid_sttus,
		           f.elctrnsanctn_sn,
		           f.cdlt_presentn_at,
		           f.acmsltproof_presentn_at,
		           f.file_group_sn,
		           f.sptdc_at,
		           f.sptdc_dt,
		           f.sptdc_place
		           , f.BID_GTN_RT
		    FROM
		    (
		        SELECT	bid_pblanc_sn,
					    bid_sj,
					    scsb_mth,
					    bid_cn,
					    pblanc_dt,
					    BID_CLOS_DT,
					    bid_sttus,
					    elctrnsanctn_sn,
					    cdlt_presentn_at,
					    acmsltproof_presentn_at,
					    file_group_sn,
					    sptdc_at,
					    sptdc_dt,
					    sptdc_place
					    , BID_GTN_RT
		        FROM   bid_pblanc
		        where 1=1
		        <include refid="where"></include>
		        order by bid_pblanc_sn desc
		    ) F
		)
		SELECT * FROM T
		WHERE T.RNUM BETWEEN (#{currentPage}*10)-(10-1) and (#{currentPage}*10)	
	</select>
	
	<select id="getBidPblancVO" parameterType="bidPblancVO" resultType="bidPblancVO">
		select *
			from bid_pblanc
			where bid_pblanc_sn = #{bidPblancSn}
	</select>
	
	<select id="getFileDetailVOList" parameterType="long" resultType="FileDetailVO">
		select * 
			from FILE_DETAIL
			where FILE_GROUP_SN = #{fileGroupSn}
	</select>
	
	<select id="getFileDetail" parameterType="map" resultType="FileDetailVO">
		select *
			from FILE_DETAIL
			where FILE_GROUP_SN = #{fileGroupSn} 
				and File_NO = #{fileNo}
	</select>
</mapper>