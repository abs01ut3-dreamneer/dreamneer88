<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.mapper.CmmntyMapper">

<!-- 나혜선 시작 -->


<!-- DB에서 시설 리스트 조회 -->

<sql id="where2">
  <if test="keyword != null and keyword != ''">
    AND (
         CMMNTY_NM LIKE '%' || #{keyword} || '%'
      OR CMMNTY_CHCKSTTUS LIKE '%' || #{keyword} || '%'
    )
</if>
</sql>


<!-- db로부터 커뮤니티 리스트 목록 조회 -->
<select id="cmmntylist" resultType="CmmtyVO">
WITH T AS(
SELECT ROW_NUMBER() OVER(ORDER BY cmmnty_sn ASC) AS row_num,
    cmmnty_sn,
    cmmnty_nm,
    tot_aceptnc_nmpr,
    cmmnty_opn_vwpoint,
    cmmnty_clos_vwpoint,
    resve_mxmm_nmpr,
    resve_mxmm_time,
    cmmnty_chcksttus,
    cmmnty_chck_dt
FROM
    cmmnty
WHERE 1 = 1
<include refid="where2"></include>
)
SELECT T.cmmnty_sn, T.cmmnty_nm, T.cmmnty_chcksttus, T.cmmnty_chck_dt
FROM T
WHERE T.cmmnty_sn BETWEEN ((#{currentPage}*10) - (10 - 1)) AND (#{currentPage} * 10)

</select>


<!-- 전체 행의 수 -->
<select id="getTotal2" resultType="int">
 SELECT COUNT(*)
   FROM CMMNTY
  WHERE 1 =1
  <include refid="where2"></include>
</select>


<update id="cmmntyupdatePost" parameterType="CmmtyVO">
UPDATE CMMNTY 
SET CMMNTY_CHCKSTTUS = #{cmmntyChcksttus},
    CMMNTY_CHCK_DT = #{cmmntyChckDt}
WHERE CMMNTY_SN = #{cmmntySn}
</update>

<!-- 모달 상태값 변경 전 db값 조회 -->
<select id="detail" resultType="CmmtyVO">
SELECT CMMNTY_SN, CMMNTY_NM, CMMNTY_CHCKSTTUS, CMMNTY_CHCK_DT
 FROM CMMNTY
WHERE CMMNTY_SN = #{cmmntySn}
</select>

<!-- 나혜선 끝 -->
</mapper>