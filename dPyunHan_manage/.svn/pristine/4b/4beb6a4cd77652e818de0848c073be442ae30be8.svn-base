<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn"%>

<!DOCTYPE html>
<html>
<head>
<title>공지사항</title>
<script src="https://cdn.ckeditor.com/ckeditor5/39.0.1/classic/ckeditor.js"></script>


<script>

	document.addEventListener("DOMContentLoaded",function(){
		
		const form = document.querySelector("#noticeForm");
		const editB = document.querySelector("#editBtn");
		const saveB = document.querySelector("#saveBtn");
		
		
		/* ckeditor 사용해봄 */
		 ClassicEditor
		    .create(document.querySelector('#noticeCn'),{
		    	toolbar: [], // 상세 들어갔을때는 툴바 없음
		    })
		    .then(editor =>{
		    	 window.editor = editor;
		    	    editor.enableReadOnlyMode('readOnly'); // CkEditor읽기 전용 활성화
		    })
		    .catch(error => {
		      console.error('Editor error:', error);
		})
		
		// 수정 버튼 클릭하면 툴바 생성을 위한거
		 editB.addEventListener("click", async () => {
			  form.querySelectorAll("input, textarea").forEach(el => el.removeAttribute('readonly'));
			  if(window.editor) {
			    await window.editor.destroy();
			  }
			  ClassicEditor
			    .create(document.querySelector('#noticeCn'))
			    .then(newEditor => {
			      window.editor = newEditor;
			    });
			  editB.style.display = "none";
			  saveB.style.display = "inline";
			});
		
	});
</script>
</head>
<body>


	<%@ include file="../include/header.jsp"%>

	<!-- /// 타이틀 시작 /// -->
	<div class="d-sm-flex align-items-center justify-content-between mb-4">
		<h1 class="h3 mb-0 text-gray-800">공지사항 관리</h1>
	</div>
	<!-- /// 타이틀 끝 /// -->


	<!-- /// body 시작 /// -->
<form id="noticeForm" action="/notice/edit" method="post">
	<input type="hidden" name="noticeSn" value="${noticeVO.noticeSn}" />
	<table class="table table-striped table-bordered">
		<tr>
			<th>공지번호</th>
			<td>${noticeVO.noticeSn}</td>
		</tr>
		<tr>
			<th>제목</th>
			<td>
			<input type="text" id="noticeSj" name="noticeSj" value="${noticeVO.noticeSj}" readonly />
			</td>
		</tr>
		<tr>
			<th>내용</th>
			<td>
			<textarea id="noticeCn" name="noticeCn" readonly>${noticeVO.noticeCn}</textarea>
			</td>
		</tr>
		<tr>
			<th>작성일</th>
			<td><fmt:formatDate value="${noticeVO.noticeWritngDt}"
					pattern="yyyy-MM-dd HH:mm:ss" /></td>
		</tr>
		<tr>
			<th>직원명</th>
			<td>${noticeVO.nm}</td>
		</tr>	
		<tr>
			<th>파일</th>
			<td>
			<c:if test="${not empty fileDetailVOList}">
				<c:forEach var="fileDetailVO" items="${fileDetailVOList}">
				<img src="/upload${fileDetailVO.fileStrelc}" style="height: 100px;">
				</c:forEach>
			</c:if>
			<c:if test="${empty fileDetailVOList}">
				<p>첨부된 파일이 없습니다.</p>
			</c:if>
			</td>
		</tr>
	</table>
	 <button type="button" id="editBtn">수정</button>
  	 <button type="submit" id="saveBtn" style="display:none;">저장</button>
  	 <button type="button" onclick="location.href='/notice/list'">돌아가기</button>
</form>

	
	
	<!-- /// body 끝 /// -->

	<%@ include file="../include/footer.jsp"%>

</body>
</html>