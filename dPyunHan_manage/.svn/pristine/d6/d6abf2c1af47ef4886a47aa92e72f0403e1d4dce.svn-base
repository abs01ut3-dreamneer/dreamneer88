<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn" %>

<script type="text/javascript" src="/js/jquery-3.6.0.js"></script>

<%@ include file="../include/header.jsp"%>

<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="/css/filter.css">
<title></title>

<script>

document.addEventListener("DOMContentLoaded",function(){
	
$(".openmodal").on("click",function(e){
	  e.preventDefault();

    //클릭한 시설 상태의 데이터 값 가져오기
    const sn = $(this).data("sn");
    const cnm = $(this).data("cnm");
    const ccs = $(this).data("ccs");
    const ccd = $(this).data("ccd");
    
    $("#statusModal").show();  //모달 열기

    //register.jsp의 값 가져오기
   $("#cmmntySn").val(sn); 
   $("#cmmntyNm").val(cnm);
   $("#cmmntyChcksttus").val(ccs);
   $("#cmmntyChckDt").val(ccd);

  
   //모달 닫기
   $("#closeModal").on("click",function(){
       $("#statusModal").hide();
   })
     
   
  });

});


</script>

</head>
<body>

<h1>커뮤니티 리스트</h1>

<!--// body 시작 //-->
 
<!-- 검색부분 시작 -->  

<form action="/" method="get" class="filter-form">
  <div class="filter-card">
    <div class="filter-card-header">
      <h3 class="filter-card-title">검색 필터</h3>
      <button type="button" class="filter-btn-toggle" onclick="toggleFilter()">
        <span class="filter-toggle-text">설정</span>
        <i class="fas fa-chevron-down"></i>
      </button>
    </div>
    
    <div class="filter-card-body collapsed" id="filterBody">
      <!-- Row 1 -->
      <div class="filter-row">
        
        <!-- 검색 필드 셀 -->
        <div class="filter-cell">
          <div class="filter-cell-label">검색 필드</div>
          <div class="filter-cell-content">
            <div class="filter-control-inline">
              <label class="filter-checkbox">
                <input type="checkbox" name="searchField" value="sercmmntyNm"/>
                <span>커뮤니티 이름</span>
              </label>
            </div>
          </div>
        </div>
        
        <!-- 정렬 셀 -->
        <div class="filter-cell">
          <div class="filter-cell-label">정렬</div>
          <div class="filter-cell-content">
            <div class="filter-control-inline">
              <label class="filter-radio">
                <input type="radio" name="sortOrder" value="desc" checked/>
                <span>최신순</span>
              </label>
              <label class="filter-radio">
                <input type="radio" name="sortOrder" value="asc" />
                <span>오래된순</span>
              </label>
            </div>
          </div>
        </div>
        
        <!-- 상태 셀 -->
        <div class="filter-cell">
          <div class="filter-cell-label">상태</div>
          <div class="filter-cell-content">
            <select name="status" class="filter-control">
              <option value="">전체</option>
              <option value="정상">정상</option>
              <option value="점검예정">점검예정</option>
              <option value="점검완료">점검완료</option>
              <option value="점검중">점검중</option>
            </select>
          </div>
        </div>

        <!-- 날짜 범위 셀 -->
        <div class="filter-cell">
          <div class="filter-cell-label">날짜 범위</div>
          <div class="filter-cell-content">
            <div class="filter-input-group">
              <input type="date" name="startDate" class="filter-control" 
                     value="${param.startDate}" />
              <span class="filter-input-group-text">~</span>
              <input type="date" name="endDate" class="filter-control" 
                     value="${param.endDate}" />
            </div>
          </div>
        </div>
        
      </div>
    </div>

    <div class="filter-search-footer">
      <div class="filter-search-wrapper">
        <input type="text" name="keyword" class="filter-input" 
               placeholder="검색어..." 
               value="${keyword}" />
      </div>
      <button type="submit" class="filter-btn filter-btn-primary">검색</button>
      <a href="/" class="filter-btn filter-btn-secondary">초기화</a>
    </div>
  </div>
</form>

<script>
function toggleFilter() {
  const filterBody = document.getElementById('filterBody');
  const toggleBtn = document.querySelector('.filter-btn-toggle i');
  
  filterBody.classList.toggle('collapsed');
  toggleBtn.classList.toggle('rotated');
}
</script>




 <!-- 검색 부분 끝 -->
  
  
 

  <div class="card shadow mb-4">
       <div class="card-header py-3" />
       <div class="card-body">
           <div class="table-responsive" style="overflow-x:hidden;"> 
               <div id="dataTable_wrapper" class="dataTables_wrapper dt-bootstrap4">
                  <div class="row">
                     <div class="col-sm-12 col-md-6">
                     <div class="dataTables_length" id="dataTable_length">
                         </div>
                        </div>
                    <div class="col-sm-12 col-md-6">
                    <div id="dataTable_filter" class="dataTables_filter">
                    </div>
                    </div>
                    </div>
                    <div class="row">
                    <div class="col-sm-12">
                    <table class="table table-bordered dataTable" id="dataTable" width="100%" cellspacing="0" role="grid" aria-describedby="dataTable_info" style="width: 100%;">
             
                  <div style="margin-left:1400px; margin-bottom:20px;">
                        <button type="button">커뮤니티 등록 </button>    <!-- 작동안해요 보여주기식 -->      
                    </div>
                    
                  <thead>
                       <tr><th rowspan="1" colspan="1">커뮤니티 이름</th>
                       <th rowspan="1" colspan="1">최근 점검 일시</th>                                       
                       <th rowspan="1" colspan="1">커뮤니티 상태</th>
                   </thead>
                   <tbody id="rowlist">
                   <c:forEach items="${cmmntyVOList}" var="CmmtyVO">
                     <tr>
                       <td>${CmmtyVO.cmmntyNm}</td>
                       <td> <fmt:formatDate value="${CmmtyVO.cmmntyChckDt}" pattern="yyyy-MM-dd" /></td> 
                       <td>
                          <a href="#" class="openmodal" 
                            data-sn="${CmmtyVO.cmmntySn}"                          
                            data-cnm="${CmmtyVO.cmmntyNm}"                          
                            data-ccs="${CmmtyVO.cmmntyChcksttus}"
                            data-ccd="<fmt:formatDate value='${CmmtyVO.cmmntyChckDt}' pattern='yyyy-MM-dd'/>">                         
                            ${CmmtyVO.cmmntyChcksttus}
                          </a>
                        </td>                                                        
                     </tr>
                   </c:forEach>
                  </tbody>
               </table>
               
               <!-- 페이징 처리부분 -->
               
				<div class="d-flex justify-content-center mt-3">
					<c:if test="${articlePage.startPage>=6}">
						<a href="/cmmnty/cmmntylist?currentPage=${articlePage.startPage-5}&keyword=${param.keyword}">[이전]</a>
					</c:if>
					&nbsp;&nbsp;
					<c:forEach var="pNo" begin="${articlePage.startPage}" end="${articlePage.endPage}" step="1">
						<a href="/cmmnty/cmmntylist?currentPage=${pNo}&keyword=${param.keyword}">[${pNo}] </a>
					</c:forEach>
					&nbsp;&nbsp;
					
					
					<c:if test="${articlePage.endPage!=articlePage.totalPages}">
						<a href="/cmmnty/cmmntylist?currentPage=${articlePage.startPage+5}&keyword=${param.keyword}">[다음]</a>
					</c:if>
			  	</div>	
               <!--페이징 처리부분 끌 -->
              </div>
             </div>            
            </div>
          </div>
       </div>
   </div>

  <!-- 시설 상태 수정 모달 -->
  <div id="statusModal" class="modal" style="display:none;">
  
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
       <h5 class="modal-title">커뮤니티 점검 상태 변경</h5>
       <button type="button" class="close" id="closeModal">닫기</button>     
      </div>
      <div class="modal-body">
        <input type="hidden" id= "cmmntySn" name="cmmntySn" value="${CmmtyVO.cmmntySn}" />
          <%@ include file="/WEB-INF/views/cmmnty/cmmntyregister.jsp" %>
     </div>
    </div>
    </div>
  </div>

<!--// body 끝 //-->

 <%@ include file="../include/footer.jsp"%>
</body>
</html>