package kr.or.ddit.service.impl;

import java.util.List;
import java.util.Map;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import kr.or.ddit.mapper.FcltyMapper;
import kr.or.ddit.service.FcltyService;
import kr.or.ddit.vo.CmmtyVO;
import kr.or.ddit.vo.FcltyVO;
import lombok.extern.slf4j.Slf4j;

@Slf4j
@Service
public class FcltyServiceImpl implements FcltyService {
	
	@Autowired
	FcltyMapper fcltymapper;

	//시설점검 결과 등록	
	/*
	 * @Override public int registerPost(FcltyVO fcltyVO) { return
	 * this.fcltymapper.registerPost(fcltyVO); }
	 */

	//시설 점검 결과 목록
	@Override
	public List<FcltyVO> list(Map<String, Object> map) {
		return this.fcltymapper.list(map);
	}

    //전체 행의 수
	@Override
	public int getTotal(Map<String, Object> map) {
		return this.fcltymapper.getTotal(map);
	}

	//모달 변경 상태값 db 변경
	@Override
	public int updatePost(FcltyVO fcltyVO) {
		//1.시설 상태변경
		int result = this.fcltymapper.updatePost(fcltyVO);
		
		log.info("result :"+result);
		
			
		// FCLTY_MANAGE의 FCLTY_MANAGE_SN 행의 갯수에 따라
		
		int manageCount = fcltymapper.selectManageCount(fcltyVO.getFcltySn());
		
		if(manageCount >= 2) {		
          result += this.fcltymapper.updateManage(fcltyVO);  //시설매니지가 2개 이상일때                                                          //해당 시설이 1개일때
		}else {
		  result += fcltymapper.updateManage2(fcltyVO);
		};
		
		return result;
	}

	// 커뮤니티 리스트 목록 조회
	@Override
	public List<CmmtyVO> cmmntylist(Map<String, Object> map) {
		return this.fcltymapper.cmmntylist(map);
	}

	//상태값 변경 전 db 값 조회
	@Override
	public FcltyVO detail(int fcltySn) {
		return this.fcltymapper.detail(fcltySn);
	}



}
