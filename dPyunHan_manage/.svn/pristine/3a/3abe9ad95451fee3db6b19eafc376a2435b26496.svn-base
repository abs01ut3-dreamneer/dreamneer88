<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn" %>

<script type="text/javascript" src="/js/jquery-3.6.0.js"></script>

<%@ include file="../include/header.jsp"%>

<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="/css/filter.css">
<title></title>

<script>

document.addEventListener("DOMContentLoaded",function(){
	
$(".openmodal").on("click",function(e){
	  e.preventDefault();

    //클릭한 시설 상태의 데이터 값 가져오기
    const sn = $(this).data("sn");
    const cl = $(this).data("cl");
    const nm = $(this).data("nm");
    const lc = $(this).data("lc");
    const st = $(this).data("st");
    const chckdt = $(this).data("chckdt");

    console.log("sn:",sn);
    
    $("#statusModal").show();  //모달 열기

    //register.jsp의 값 가져오기
   $("#fcltySn").val(sn); 
   $("#fcltyCl").val(cl);
   $("#fcltyNm").val(nm);
   $("#fcltyLc").val(lc);
   $("#fcltySttus").val(st);
   $("#fcltyChckDt").val(chckdt);
   
  
   $("#fcltyNm option").filter(function(){
	   return $(this).text() === nm; 
   }).prop("selected",true);

   //모달 닫기
   $("#closeModal").on("click",function(){
       $("#statusModal").hide();
   })
   

     
  });

});

</script>

</head>
<body>



<div class="card card-warning disabled">  <!-- 색상 지정 -->
              <div class="card-header">  
                <h3 class="card-title">시설/보안 목록</h3>
              </div>
              <!-- /.card-header  -->
              <div class="card-body" style="overflow-x:hidden;">
              
  <!-- 검색필터 시작 -->
	 <form action="/" method="get" class="filter-form">
		 <div class="filter-card">
		   <div class="filter-card-header">
		     <h3 class="filter-card-title">검색 필터</h3>
		     <button type="button" class="filter-btn-toggle" onclick="toggleFilter()">
		       <span class="filter-toggle-text">설정</span>
		       <i class="fas fa-chevron-down"></i>
		     </button>
		   </div>
		   
		   <div class="filter-card-body collapsed" id="filterBody">
		     <!-- Row 1 -->
		     <div class="filter-row">
		       
		       <!-- 검색 필드 셀 -->
		       <div class="filter-cell">
		         <div class="filter-cell-label">검색 필드</div>
		         <div class="filter-cell-content">
		           <div class="filter-control-inline">
		             <label class="filter-checkbox">
	                <input type="checkbox" name="searchField" value="serfcltyCl"/>
	                <span>시설분류</span>
	              </label>
	              <label class="filter-checkbox">
	                <input type="checkbox" name="searchField" value="serfcltyNm" />
	                <span>시설이름</span>
	              </label>
	              <label class="filter-checkbox">
	                <input type="checkbox" name="searchField" value="serfcltyLc" />
	                <span>시설위치</span>
	              </label>
		           </div>
		         </div>
		       </div>
		       
		       <!-- 정렬 셀 -->
		       <div class="filter-cell">
		         <div class="filter-cell-label">정렬</div>
		         <div class="filter-cell-content">
		           <div class="filter-control-inline">
		             <label class="filter-radio">
		               <input type="radio" name="sortOrder" value="desc" checked/>
		               <span>최신순</span>
		             </label>
		             <label class="filter-radio">
		               <input type="radio" name="sortOrder" value="asc" />
		               <span>오래된순</span>
		             </label>
		           </div>
		         </div>
		       </div>
		       
		       <!-- 상태 셀 -->
		       <div class="filter-cell">
		         <div class="filter-cell-label">상태</div>
		         <div class="filter-cell-content">
		           <select name="status" class="filter-control">
		             <option value="">전체</option>
		             <option value="정상">정상</option>
		             <option value="점검예정">점검예정</option>
		             <option value="점검완료">점검완료</option>
		             <option value="점검중">점검중</option>
		           </select>
		         </div>
		       </div>
		
		       <!-- 날짜 범위 셀 -->
		       <div class="filter-cell">
		         <div class="filter-cell-label">날짜 범위</div>
		         <div class="filter-cell-content">
		           <div class="filter-input-group">
		             <input type="date" name="startDate" class="filter-control" 
		                    value="${param.startDate}" />
		             <span class="filter-input-group-text">~</span>
		             <input type="date" name="endDate" class="filter-control" 
		                    value="${param.endDate}" />
		           </div>
		         </div>
		       </div>
		       
		     </div>
		   </div>
		
		   <div class="filter-search-footer">
		     <div class="filter-search-wrapper">
		       <input type="text" name="keyword" class="filter-input" 
		              placeholder="검색어..." 
		              value="${keyword}" />
		      </div>
		      <button type="submit" class="filter-btn filter-btn-primary">검색</button>
		      <a href="/" class="filter-btn filter-btn-secondary">초기화</a>
		       <button type="button" style="background-color:mediumseagreen;color:white;border-radius: 4px;border: 0;height: 26px;">시설/보안 등록 </button>    <!-- 작동안해요 보여주기식 -->     
		    </div>
		  </div>
	</form>

		<script>
		function toggleFilter() {
		  const filterBody = document.getElementById('filterBody');
		  const toggleBtn = document.querySelector('.filter-btn-toggle i');
		  
		  filterBody.classList.toggle('collapsed');
		  toggleBtn.classList.toggle('rotated');
		}
		</script>

 <!-- 검색필터 끝 -->
 
 <!-- body 시작 -->
                <table class="table table-bordered table-hover" style="text-align:center;">   <!-- 기능 지정 -->
                  <thead>
                    <tr class="bg-secondary disabled">  <!-- 색상 지정 -->
                      <th class="col-1">순번</th>
                      <th class="col-2">시설 분류</th>
                      <th class="col-2">시설 이름</th>
                      <th class="col-2">시설 위치</th>
                      <th class="col-3">최근 점검 일자</th>
                      <th class="col-2">시설/보안 상태</th>
                    </tr>
                  </thead>
                  <tbody id="rowlist">
                   <c:forEach items="${fcltyVOList}" var="fcltyVO" varStatus="status">
                    <tr>
                      <td>${(articlePage.currentPage - 1)*10 + status.index + 1}</td>  <!-- (articlePage.currentPage - 1)*10 : 이전 페이지에 있던 글의 수 -->
                      <td>${fcltyVO.fcltyCl}</td>
                      <td>${fcltyVO.fcltyNm}</td>
                      <td>${fcltyVO.fcltyLc}</td>
                      <td> <fmt:formatDate value="${fcltyVO.fcltyChckDt}" pattern="yyyy-MM-dd" /></td> 
                      <td>
                         <a href="#" class="openmodal" 
                            data-sn="${fcltyVO.fcltySn}"
                            data-cl="${fcltyVO.fcltyCl}"
                            data-nm="${fcltyVO.fcltyNm}"
                            data-lc="${fcltyVO.fcltyLc}"
                            data-st="${fcltyVO.fcltySttus}"
                            data-chckdt="<fmt:formatDate value='${fcltyVO.fcltyChckDt}' pattern='yyyy-MM-dd'/>">
                            ${fcltyVO.fcltySttus}
                          </a>
                      </td>     
                    </tr>
                     </c:forEach>
                     </tbody>
                    </table> 
                                                  
       <!-- 페이징 처리부분 -->
	      <div class="card-footer clearfix">
	  <ul class="pagination pagination-sm m-0 float-right">
	    
	    <!-- 이전 버튼 -->
	    <c:if test="${articlePage.startPage >= 6}">
	      <li class="page-item">
	        <a class="page-link" href="/cmmnty/cmmntylist?currentPage=${articlePage.startPage-5}&keyword=${param.keyword}">«</a>
	      </li>
	    </c:if>
	    <c:if test="${articlePage.startPage < 6}">
	      <li class="page-item disabled">
	        <a class="page-link" href="#">«</a>
	      </li>
	    </c:if>
	
	    <!-- 페이지 번호 -->
		    <c:forEach var="pNo" begin="${articlePage.startPage}" end="${articlePage.endPage}">
		      <li class="page-item <c:if test='${pNo == articlePage.currentPage}'>active</c:if>">
		        <a class="page-link" href="/fclty/list?currentPage=${pNo}&keyword=${param.keyword}">
		          ${pNo}
		        </a>
		      </li>
		    </c:forEach>
		
		    <!-- 다음 버튼 -->
		    <c:if test="${articlePage.endPage != articlePage.totalPages}">
		      <li class="page-item">
		        <a class="page-link" href="/fclty/list?currentPage=${articlePage.startPage+5}&keyword=${param.keyword}">»</a>
		      </li>
		    </c:if>
		    <c:if test="${articlePage.endPage == articlePage.totalPages}">
		      <li class="page-item disabled">
		        <a class="page-link" href="#">»</a>
		      </li>
		    </c:if>
		  </ul>
		</div>
	<!-- 페이징 처리 끝-->             
            </div>
          </div>          

 <!-- body 끝 -->


  <!-- 시설 상태 수정 모달 -->
  <div id="statusModal" class="modal" style="display:none;">
  
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-warning disabled">  <!-- 색상 지정 -->
       <h5 class="modal-title">시설/보안 상태 변경</h5>
       <button type="button" class="close" id="closeModal">닫기</button>     
      </div>
      <div class="modal-body">
        <input type="hidden" id= "fcltySn" name="fcltySn" value="${fcltyVO.fcltySn}" />
          <%@ include file="/WEB-INF/views/fclty/register.jsp" %>
     </div>
    </div>
    </div>
  </div>


 <%@ include file="../include/footer.jsp"%>
</body>
</html>