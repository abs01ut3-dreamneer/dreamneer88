<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn" %>

<script type="text/javascript" src="/js/jquery-3.6.0.js"></script>

<%@ include file="../include/header.jsp"%>

<!DOCTYPE html>
<html>
<head>
<title></title>

<script>

</script>

</head>
<body>

<h1>시설 관리 리스트</h1>

<!--// body 시작 //-->
 
<form action="/fcltyManage/list" method="get" style="margin-left:1300px;">
     <input type="text" name="keyword" value="${param.keyword}" placeholder="검색어 입력" />
     <button type="submit">검색</button>
  </form> 
 

  <div class="card shadow mb-4">
       <div class="card-header py-3" />
       <div class="card-body">
           <div class="table-responsive">
               <div id="dataTable_wrapper" class="dataTables_wrapper dt-bootstrap4">
                  <div class="row">
                     <div class="col-sm-12 col-md-6">
                     <div class="dataTables_length" id="dataTable_length">
                         </div>
                        </div>
                    <div class="col-sm-12 col-md-6">
                    <div id="dataTable_filter" class="dataTables_filter">
                    </div>
                    </div>
                    </div>
                    <div class="row">
                    <div class="col-sm-12">
                                                        
                    <table class="table table-bordered dataTable" id="dataTable" width="100%" cellspacing="0" role="grid" aria-describedby="dataTable_info" style="width: 100%;">
             
                  <thead>
                       <tr><th rowspan="1" colspan="1">담당자</th>
                       <th rowspan="1" colspan="1">시설/보안 정보</th>
                       <th rowspan="1" colspan="1">커뮤니티 정보</th>
                       <th rowspan="1" colspan="1">관리 시작 일시</th>
                       <th rowspan="1" colspan="1">관리 종료 일시</th>                                       
                       <th rowspan="1" colspan="1">총 예정 기간</th>                                       
                       <th rowspan="1" colspan="1">비 고</th>                                       
                                                         
                   </thead>
                   <tbody id="rowlist">
                   <c:forEach var="ohoh" items="${fcllist}">

                     <c:choose>
                       <c:when test="${ohoh.fcltymanageChcksttus eq '점검예정' or ohoh.fcltymanageChcksttus eq '점검중'}">
                         <tr>
                       </c:when>
                       <c:otherwise>
                          <tr style="background-color:lightgray; pointer-events:none;">
                       </c:otherwise>
                     </c:choose> 

                       
                        <td><input type="hidden" value="${ohoh.empId}" />${ohoh.empVO.nm}</td>    <!-- 담당자 -->
                        
                       <c:choose>
                         <c:when test="${not empty ohoh.fcltyVO.fcltySn}">     <!-- 시설/보안정보 -->
                        <td><input type="hidden" value="${ohoh.fcltySn}" />${ohoh.fcltyVO.fcltyNm} ${ohoh.fcltyVO.fcltyLc}</td>
                         </c:when>
                         <c:otherwise>
                        <td><input type="hidden" value="${ohoh.fcltySn}" /> - </td>
                         </c:otherwise>
                       </c:choose>
                        
                        <c:choose>
                         <c:when test="${not empty ohoh.cmmtyVO.cmmntySn}">   <!-- 커뮤니티 정보 -->
                        <td><input type="hidden" value="${ohoh.cmmntySn}" />${ohoh.cmmtyVO.cmmntyNm}</td>
                         </c:when>
                         <c:otherwise>
                         <td><input type="hidden" value="${ohoh.cmmntySn}" /> - </td>
                         </c:otherwise>
                        </c:choose>
                        
                        <td><fmt:formatDate value="${ohoh.fcltymanageBeginDt}" pattern="yyyy-MM-dd HH:mm"/></td>  <!-- 관리 시작일시 -->
                        <td><fmt:formatDate value="${ohoh.fcltymanageEndDt}" pattern="yyyy-MM-dd HH:mm"/></td>    <!-- 관리 종료일시 -->
                        <td>${ohoh.fcltymanagePrearngePd}일</td>   <!-- 총 예정 기간 -->
                       
                      <td> 
                         <c:choose>
                           <c:when test="${(ohoh.fcltymanageChcksttus eq '점검예정') or (ohoh.fcltymanageChcksttus eq '점검중')}">
                             <button type="button" class="btn btn-sm btn-primary openScheduleModal BtnChange" style="display: inline-block;">일정등록</button>
                           </c:when>
                           <c:otherwise>
                             <button type="button" class="btn btn-sm btn-primary openScheduleModal BtnChange" style="display: none;">일정등록</button>
                           </c:otherwise>
                         </c:choose>                         
                       </td>
                      </tr>
                     <p>${ohoh.fcltymanageChcksttus}</p>
                      
                    </c:forEach>
                    
                  </tbody>
               </table>
               
           
                     
               <!-- 페이징 처리부분 -->
               
				<div class="d-flex justify-content-center mt-3">
					<c:if test="${articlePage.startPage>=6}">
						<a href="/fcltyManage/list?currentPage=${articlePage.startPage-5}&keyword=${param.keyword}">[이전]</a>
					</c:if>
					&nbsp;&nbsp;
					<c:forEach var="pNo" begin="${articlePage.startPage}" end="${articlePage.endPage}" step="1">
						<a href="/fcltyManage/list?currentPage=${pNo}&keyword=${param.keyword}">[${pNo}] </a>
					</c:forEach>
					&nbsp;&nbsp;
					
					<c:if test="${articlePage.endPage!=articlePage.totalPages}">
						<a href="/fcltyManage/list?currentPage=${articlePage.startPage+5}&keyword=${param.keyword}">[다음]</a>
					</c:if>
			  	</div>	
               <!--페이징 처리부분 끌 -->
              </div>
             </div>            
            </div>
          </div>
       </div>
   </div>
   
<!-- 점검 상태 수정 모달 시작 -->

   <div id="updateModal" class="modal" style="display:none;">
  
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
       <h5 class="modal-title">점검 상태 변경</h5>
       <button type="button" class="close" id="closeModal">닫기</button>     
      </div>
      <div class="modal-body">
       <form action="/fcltyManage/updatePost" method="post">     
        <input type="hidden" id= "fcltyManageSn" name="fcltyManageSn" value="${FcltyManageVO.fcltyManageSn}" />
        
        <table>
          <tr>
            <th>점검 상태</th>
             <td>
            <select id="fclmanageSttus" name="fclmanageSttus" >
                <option value="">---선택하세요---</option>                      
                <option value="정상">정상</option>                      
                <option value="점검예정">점검예정</option>                      
                <option value="점검중">점검중</option>                      
                <option value="점검완료">점검완료</option>                                         
                <option value="고장">고장(시설)</option>                      
                <option value="폐기">폐기(시설)</option>                                      
                <option value="운전중지">운전중지(시설)</option>                      
                <option value="운영중지">미운영(커뮤니티)</option>                      
               </select>  
             </td>
          </tr>
        </table>           
      <div class="modal-footer justify-content-between">   
        <button type="button" id="ok">등록</button>
		<button type="reset" id="cancel">취소</button>	
	  </div>	
	 </form> 
     </div>
    </div>
    </div>
  </div>
<!-- 점검 상태 수정 모달 끝 -->
     
      
<!--// body 끝 //-->

 <%@ include file="../include/footer.jsp"%>
</body>
</html>