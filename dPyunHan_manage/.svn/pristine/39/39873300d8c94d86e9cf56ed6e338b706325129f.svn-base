<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn"%>
<!DOCTYPE html>
<html>
<head>

<title></title>
</head>
<style>
.drft-table, .sanctnln-table {
	width: 100%;
	height: 180px;
	border-collapse: collapse;
	border: 2px solid black;
}

.reference-table {
	width: 100%;
	height: auto;
	/* 높이 자동 조절 */
	border-collapse: collapse;
	border: 2px solid black;
	margin-bottom: 20px;
}

.reference-table td {
	border: 2px solid black;
	height: 40px;
	/* 한 줄만 필요하니 40px */
	text-align: center;
}

.drft-table td, .sanctnln-table td {
	border: 2px solid black;
	height: 40px;
	text-align: center;
}

.drft-table .header, .sanctnln-table .header, .reference-table .header {
	font-weight: bold;
}

#sanctnlnArea {
	display: flex;
	gap: 30px;
	align-items: flex-start;
}

#sanctnlnArea>div:first-child {
	flex: 0 0 auto;
}

#sanctnlnArea>div:last-child {
	flex: 1;
	min-width: 500px;
}

.drft-table {
	width: 200px;
}

.sanctnln-table, .reference-table {
	width: 100%;
	margin-bottom: 20px;
}
</style>
<script type="text/javascript" src="/ckeditor5/ckeditor.js"></script>
<script type="text/javascript">
	document.addEventListener("DOMContentLoaded", function(){
		ClassicEditor
			.create(document.querySelector('#editor'), {
				// 에디터 설정
				toolbar: ['heading', '|', 'bold', 'italic', 'link', 'bulletedList', 'numberedList', 'blockQuote'],
				height: '500px',
				ckfinder: { uploadUrl: '/image/upload' }
			})
			.then(editor => {
				window.editor = editor;
			})
			.catch(error => {
				console.error("check: editor error => ", error);
			});
		
		fetch("/elctrnsanctn/getSanctnlnList", {
			method:"post"
		})
		.then(resp=>{

		})
		.then(data=>{

		})
		.catch(error=>{

		})
		
	})
</script>
<body>
	<%@ include file="../include/header.jsp"%>

	<div class="jumbotron">
		<div class="container">
			<h1 class="display-3">전자 결재 상세</h1>
			${elctrnsanctnVO }
		</div>
	</div>

	<!--/// body /// -->
	<div>
		<h3>기본 설정</h3>

		<table border="1">
			<tr>
				<td>문서 종류</td>
				<td>${elctrnsanctnVO.drftDocVO.elctrnsanctnManageVO.sanctnSecode}</td>
				<td>${elctrnsanctnVO.drftDocVO.drftDocNm}</td>
				<td>기안자 <input type="hidden" id="drftEmpId" name="drftEmpId"
					value="${empVO.empId}">
				</td>
				<td>${empVO.nm}</td>
			</tr>
			<tr>
				<td>등록 일시</td>
				<td><fmt:formatDate value="${elctrnsanctnVO.creatDt}"
						pattern="yyyy-MM-dd" /></td>
				<td>기안 일시</td>
				<td><fmt:formatDate value="${elctrnsanctnVO.drftDt}"
						pattern="yyyy-MM-dd" /></td>
				<td><c:if test="${elctrnsanctnVO.drftTmprstre == 1}">
               				임시저장
                   		</c:if></td>
			</tr>
		</table>
		<!-- 기안_문서 -->
	</div>

	<div id="btns" style="display: none;">
		<input type="button" id="tempDrftSave" value="임시저장" /> <input
			type="button" id="permDrftSave" value="기안하기" /> <input type="button"
			id="preview" value="인쇄미리보기" />
	</div>

	<div>
		<h3>결재선</h3>

		<div id="sanctnlnArea">
		${elctrnsanctnVO.drftDocVO.drftDocFormat}
			<!-- 여기부터 기안 서식-->
<!-- 			<div> -->
<!-- 				<table class="drft-table"> -->
<!-- 					<tr> -->
<!-- 						<td>기안자<input type="hidden" name="empId" -->
<%-- 							value="${empVO.empId}"></td> --%>
<!-- 					</tr> -->
<!-- 					<tr> -->
<!-- 						<td><input type="text" name="clsfName" -->
<%-- 							value="${empVO.clsfName}" readonly></td> --%>
<!-- 					</tr> -->
<!-- 					<tr> -->
<%-- 						<td><input type="text" name="nm" value="${empVO.nm}" readonly></td> --%>
<!-- 					</tr> -->
<!-- 				</table> -->
<!-- 			</div> -->
<!-- 			<div> -->
<!-- 				<table class="sanctnln-table"> -->
<!-- 					<tbody> -->
<!-- 						<tr class="tr-sanctnln-ordr"> -->
<!-- 							<td rowspan="4" class="header">결재</td> -->
<!-- 							<td class="label-cell">결재 순서</td> -->
<!-- 						</tr> -->
<!-- 						<tr class="tr-clsf"> -->
<!-- 							<td class="label-cell">직급</td> -->
<!-- 						</tr> -->
<!-- 						<tr class="tr-nm"> -->
<!-- 							<td class="label-cell">이름</td> -->
<!-- 						</tr> -->
<!-- 						<tr class="tr-empId"> -->
<!-- 							<td class="label-cell">직원 ID</td> -->
<!-- 						</tr> -->
<!-- 					</tbody> -->
<!-- 				</table> -->
<!-- 				<br> -->
<!-- 				<table class="reference-table"> -->
<!-- 					<tr class="tr-reference"> -->
<!-- 						<td class="header">참조</td> -->
<!-- 						<td class="data-cell" id="reference-display"></td> -->
<!-- 					</tr> -->
<!-- 				</table> -->
<!-- 			</div> -->
			<!-- 여기까지 기안 서식-->
		</div>
	</div>

	<div>
		<h3>상세 입력</h3>

		<div id="drftCnArea">
			<p>제목</p>
			<input type="text" value="${elctrnsanctnVO.drftSj}" id="drftSj"
				name="drftSj"
				<c:if test="${elctrnsanctnVO.drftTmprstre != 1 || elctrnsanctnVO.empId != empVO.empId}">
					readonly
					</c:if>>

			<p>본문</p>
			<textarea id="editor" name="drftCn"
				<c:if test="${elctrnsanctnVO.drftTmprstre != 1 || elctrnsanctnVO.empId != empVO.empId}">readonly</c:if>>
					${elctrnsanctnVO.drftCn}
				</textarea>
		</div>

	</div>

	<c:if
		test="${elctrnsanctnVO.drftTmprstre == 1 && elctrnsanctnVO.empId == empVO.empId}">
		<div id="btns">
			<button id="editBtn">수정하기</button>
			<button id="submitBtn">기안하기</button>
			<button id="deleteBtn">삭제</button>
		</div>
	</c:if>

	<script>		
		// 수정 버튼 클릭 시 readonly 해제
		document.querySelector("#editBtn")?.addEventListener("click", function() {
		    document.querySelector("#drftSj").removeAttribute("readonly");
		    if(window.editor) {
		        window.editor.disableReadOnlyMode('detail-view');
		    }
		});
		</script>



	<!-- /// body /// -->

	<%@ include file="../include/footer.jsp"%>
</body>
</html>