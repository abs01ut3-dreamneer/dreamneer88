<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<%@ include file="../include/header.jsp" %>
<script type="text/javascript" src="/js/jquery-3.6.0.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<h2>ğŸ“Š ì›”ë³„ ê²€ì¹¨ ë°ì´í„°</h2>
<style>
    body { font-family: sans-serif; margin: 20px; }
    table { width: 80%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
    th { background-color: #f2f2f2; }
    h2 { color: #333; }
    .search-form {
        background-color: #f9f9f9;
        border: 1px solid #eee;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 5px;
    }
    .search-form input[type="text"],
    .search-form input[type="month"] {
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }
    .search-form button {
        padding: 8px 12px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    .search-form button:hover { background-color: #0056b3; }
    .search-form button.reset { background-color: #6c757d; }
    .search-form button.reset:hover { background-color: #5a6268; }
</style>
</head>
<body>

<h2>ì„¸ëŒ€ ê²€ì¹¨ ì´ë ¥ (ì›ë³¸ ë°ì´í„°)</h2>
<div class="search-form">
    <form action="${pageContext.request.contextPath}/mtinsp/mtinspView" method="get">
        ì„¸ëŒ€ ID:
        <input type="text"
               name="hshldId"
               value="${searchHshldId}"
               placeholder="ì˜ˆ: 11011001" />

        &nbsp;&nbsp; ê²€ìƒ‰ ì›”:
        <input type="month"
               name="searchMonth"
               value="${searchMonth}" />

        &nbsp;&nbsp;

        <button type="submit">ì¡°íšŒ</button>


        <button type="button" class="reset"
                onclick="location.href='${pageContext.request.contextPath}/mtinsp/mtinspView'">
            ì „ì²´ë³´ê¸°
        </button>
    </form>
    <div style="width: 100%;margin-top: 20px;">
        <canvas id="myChart"></canvas>
    </div>
</div>
<table>
    <thead>
    <tr>
        <th>ê²€ì¹¨ ì‹œê°„</th>
        <th>ì „ê¸° ì‚¬ìš©ëŸ‰ (kWh)</th>
        <th>ìˆ˜ë„ ì‚¬ìš©ëŸ‰ (t)</th>
        <th>ê°€ìŠ¤ ì‚¬ìš©ëŸ‰ (mÂ³)</th>
    </tr>
    </thead>
    <tbody>
    <c:choose>
        <c:when test="${not empty dataList}">
            <%-- dataListëŠ” PivotedMtinspVOì˜ ë¦¬ìŠ¤íŠ¸ --%>
            <c:forEach items="${dataList}" var="item">
                <tr>
                    <td>
                            <%-- ë‚ ì§œ í¬ë§·íŒ… (PivotedMtinspVOì˜ mtinspDt) --%>
                        <fmt:formatDate value="${item.mtinspDt}" pattern="MM-dd HH:mm" />
                    </td>
                    <td><fmt:formatNumber value="${item.electricUsage}" pattern="#,##0.0#" /></td>
                    <td><fmt:formatNumber value="${item.waterUsage}" pattern="#,##0.0#" /></td>
                    <td><fmt:formatNumber value="${item.gasUsage}" pattern="#,##0.0#" /></td>
                </tr>
            </c:forEach>
        </c:when>
        <c:otherwise>
            <tr>
                <td colspan="4">ì¡°íšŒëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td>
            </tr>
        </c:otherwise>
    </c:choose>
    </tbody>
</table>


<%-- 4. (ğŸ’¥ğŸ’¥ğŸ’¥ ìˆ˜ì •) "í”¼ë²—ëœ" ê·¸ë˜í”„ ìŠ¤í¬ë¦½íŠ¸ --%>
<script>
    // 5. ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ë„˜ê¸´ 4ê°œì˜ JSONì„ JS ë³€ìˆ˜ë¡œ ì£¼ì…
    // (ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì´ 4ê°œ ë³€ìˆ˜ë¥¼ ëª¨ë¸ì— ì•ˆ ë‹´ì•˜ìœ¼ë©´ ì—ëŸ¬ë‚©ë‹ˆë‹¤)
    var chartLabels = ${chartLabels};
    var electricData = ${chartElectric};
    var waterData = ${chartWater};
    var gasData = ${chartGas};

    // 6. Chart.js ì‹¤í–‰
    const ctx = document.getElementById('myChart').getContext('2d');
    new Chart(ctx, {
        type: 'line', // êº¾ì€ì„  ê·¸ë˜í”„
        data: {
            labels: chartLabels, // Xì¶• (ë‚ ì§œ/ì‹œê°„ ë¦¬ìŠ¤íŠ¸)
            datasets: [
                {
                    label: 'ì „ê¸° ì‚¬ìš©ëŸ‰ (kWh)',
                    data: electricData, // Yì¶• (ì „ê¸°)
                    borderColor: 'rgba(255, 99, 132, 1)', // ë¹¨ê°•
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    tension: 0.1
                },
                {
                    label: 'ìˆ˜ë„ ì‚¬ìš©ëŸ‰ (t)',
                    data: waterData, // Yì¶• (ìˆ˜ë„)
                    borderColor: 'rgba(54, 162, 235, 1)', // íŒŒë‘
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    tension: 0.1
                },
                {
                    label: 'ê°€ìŠ¤ ì‚¬ìš©ëŸ‰ (mÂ³)',
                    data: gasData, // Yì¶• (ê°€ìŠ¤)
                    borderColor: 'rgba(75, 192, 192, 1)', // ì´ˆë¡
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    tension: 0.1
                }
            ]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>

<%@ include file="../include/footer.jsp" %>