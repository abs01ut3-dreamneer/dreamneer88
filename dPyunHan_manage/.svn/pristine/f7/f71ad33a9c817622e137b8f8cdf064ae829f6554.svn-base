<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn"%>
<link rel="stylesheet" href="/css/filter.css">

<style>
/* 공통 카드별 상단 영역 시작 */
body { /* 그냥 폰트 */
	font-family: 'Noto Sans KR', 'Source Sans Pro', sans-serif;
}

.card {
	padding: 0.3rem !important;
	border-radius: 1.5rem !important;
	overflow: hidden !important;
	box-shadow: 0 6px 18px rgba(0, 0, 0, 0.15) !important;
}

.card-header .card-title {
	font-size: 1.2rem !important; /* 글자 크기 */
	font-weight: 700 !important;
	/* 글자 두께 살짝 굵게  400이 기본, 700이 bord정도 입니다. */
	padding-top: 4px !important; /* 상단패딩*/
	padding-bottom: 4px !important;
}
/* 공통 카드별 상단 영역 끝 */
.card-body {
	padding: 1rem !important;
}

.card-footer {
	padding: 1rem !important;
}
/* 공통 테이블 간격을 줄 간격 맞추기. table 생성시 꼭 사용하세요 시작 */
.tight-table, .tight-table th, .tight-table td {
	padding: 3px 5px !important; /* 테이블들 행간격 */
	overflow: hidden !important; /* 삐져나가는거 잡아줘요 */
	text-overflow: ellipsis; /* 길어진 글은 ...처리 */
	white-space: nowrap; /* 줄바꿈 X */
	text-align: center;
}
/* 줄무늬 효과(odd는 홀수, even은 짝수) */
.tight-table tbody tr:nth-child(odd) {
	background-color: #ffffff; /* 흰색 */
}

.tight-table tbody tr:nth-child(even) {
	background-color: #f1f4fa; /* 연한 회색(AdminLTE 느낌) */
}
/* 공통 테이블 간격을 줄 간격 맞추기. table 생성시 꼭 사용하세요 끝 */
/* 호버이벤트 시작 */
/* tight-table호버이벤트시작 */
.table tbody tr {
	transition: background-color 0.25s ease, box-shadow 0.25s ease,
		transform 0.2s ease;
}

.table tbody tr:hover {
	background-color: rgba(100, 140, 164, 0.12) !important; /* 은은한 파스텔 */
	box-shadow: 0 3px 12px rgba(0, 0, 0, 0.15); /* 은은한 그림자 */
	transform: translateY(-1px); /* 살짝 띄우기 */
	cursor: pointer;
}
/* 호버이벤트 끝 */

/* 모달 css영역 시작입니다 */
/* 모달 프레임 자체 */
.cute-modal .modal-content {
	border: 0 !important;
	border-radius: 14px !important;
	box-shadow: 0 6px 24px rgba(0, 0, 0, .12) !important;
	overflow: hidden !important;
}

/* 헤더 영역 */
.cute-modal .modal-header {
	background: rgba(100, 140, 164, .85) !important;
	color: #fff !important;
	padding: .6rem .9rem !important;
}

/* 제목(좌측) */
.cute-modal .modal-title {
	font-size: 1rem !important;
	display: flex !important;
	gap: .5rem !important;
	align-items: center !important;
	margin: 0 !important;
}

.cute-modal .modal-title small {
	font-size: .85rem !important;
}

/* 닫기 버튼 */
.cute-modal .close, .cute-modal .btn-close, .cute-modal .btn-close-white
	{
	color: #fff !important;
	opacity: .9 !important;
	text-shadow: none !important;
}

.cute-modal .close:hover, .cute-modal .btn-close:hover, .cute-modal .btn-close-white:hover
	{
	opacity: 1 !important;
}

/* 본문 기본 패딩 */
.cute-modal .modal-body {
	padding: .9rem !important;
}

/* 필드 라벨 (제목, 기간, 내용 등) */
.cute-modal .field-label {
	color: #6b7b86 !important;
	font-size: .875rem !important;
	margin-bottom: .25rem !important;
}

/* 상단 메타 정보(기간 + 내용) 박스 */
.cute-modal .cute-meta-box {
	display: grid !important;
	grid-template-columns: 92px 1fr !important;
	row-gap: .35rem !important;
	column-gap: .75rem !important;
	padding: .8rem !important;
	border: 1px solid rgba(0, 0, 0, .06) !important;
	border-radius: 10px !important;
	background: rgba(100, 140, 164, .12) !important; 
	margin-bottom: .75rem !important;
}

.cute-modal .cute-meta-label {
	color: #6b7b86 !important;
	font-size: .875rem !important;
	align-self: center !important;
}

.cute-modal .cute-meta-label.top {
	align-self: flex-start !important;
}

.cute-modal .cute-meta-value {
	font-weight: 600 !important;
	font-size: .95rem !important;
}

/* 내용 textarea */
.cute-modal textarea.form-control {
	resize: none !important;
}

/* 섹션 제목 (ex. 투표 항목, 첨부파일 등) */
.cute-modal .cute-section-title {
	margin: 0 0 .5rem 0 !important;
}

/* 테이블 – Dewi/BS5/BS4 모두 공통 느낌 */
.cute-modal .cute-table {
	margin-top: .25rem !important;
}

.cute-modal .cute-table thead th {
	background: #f6f8fa !important;
	border-bottom: 1px solid rgba(0, 0, 0, .06) !important;
}

/* 버튼 줄 */
.cute-modal .cute-btn-row {
	margin-top: .5rem !important;
}

/* 버튼 */
.cute-modal .btn-round-sm {
	padding: .35rem .7rem !important;
	border-radius: 10px !important;
}
/* 모달 css영역 끝 입니다 */
</style>

<%@ include file="../include/header.jsp"%>


<section class="content" style="margin: 20px">
	<div class="container-fluid">
		<!-- 섹션/컨테이너 영역 -->
		<div class="row">
			<div class="col-md-12">





				<!-- 카드 시작 -->
				<div class="card card bg-light">
					<!-- 카드헤더 시작 -->
					<div class="card-header d-flex justify-content-between align-items-center">
						<!-- 좌 제목 -->
						<h5 class="card-title mb-0">사내 공지사항</h5>
						<!-- 우 검색 -->
						<div class="search-area ml-auto d-flex">

							<form action="/notice/list" method="get" class="filter-form">
								<div class="filter-card">
									<div class="filter-card-header">
										<h3 class="filter-card-title">검색 필터</h3>
										<button type="button" class="filter-btn-toggle"
											onclick="toggleFilter()">
											<span class="filter-toggle-text">설정</span> <i
												class="fas fa-chevron-down"></i>
										</button>
									</div>

									<div class="filter-card-body collapsed" id="filterBody">
										<!-- Row 1 -->
										<div class="filter-row">

											<!-- 검색 필드 셀 -->
											<div class="filter-cell">
												<div class="filter-cell-label">검색 필드</div>
												<div class="filter-cell-content">
													<div class="filter-control-inline">
														<label class="filter-checkbox"> <input
															type="checkbox" name="searchField" value="noticeSj" /> <span>번호</span>
														</label> <label class="filter-checkbox"> <input
															type="checkbox" name="searchField" value="noticeCn" /> <span>내용</span>
														</label> <label class="filter-checkbox"> <input
															type="checkbox" name="searchField" value="nm" /> <span>직원명</span>
														</label>
													</div>
												</div>
											</div>

											<!-- 정렬 셀 -->
											<div class="filter-cell">
												<div class="filter-cell-label">정렬</div>
												<div class="filter-cell-content">
													<div class="filter-control-inline">
														<label class="filter-radio"> <input type="radio"
															name="sortOrder" value="desc" checked /> <span>최신순</span>
														</label> <label class="filter-radio"> <input type="radio"
															name="sortOrder" value="asc" /> <span>오래된순</span>
														</label>
													</div>
												</div>
											</div>

											<!-- 상태 셀 -->
											<div class="filter-cell">
												<div class="filter-cell-label">상태</div>
												<div class="filter-cell-content">
													<select name="status" class="filter-control">
														<option value="">전체</option>
														<option value="1">활성</option>
														<option value="0">비활성</option>
													</select>
												</div>
											</div>

											<!-- 날짜 범위 셀 -->
											<div class="filter-cell">
												<div class="filter-cell-label">날짜 범위</div>
												<div class="filter-cell-content">
													<div class="filter-input-group">
														<input type="date" name="startDate" class="filter-control"
															value="${param.startDate}" /> <span
															class="filter-input-group-text">~</span> <input
															type="date" name="endDate" class="filter-control"
															value="${param.endDate}" />
													</div>
												</div>
											</div>

										</div>
									</div>

									<div class="filter-search-footer">
										<div class="filter-search-wrapper">
											<input type="text" name="keyword" class="filter-input"
												placeholder="검색어..." value="${keyword}" />
										</div>
										<button type="submit" class="filter-btn filter-btn-primary">검색</button>
										<a href="/notice/list" class="filter-btn filter-btn-secondary">초기화</a>
									</div>
								</div>
							</form>
						</div>
					</div>
					<!-- 카드헤더 끝 -->
					<!-- 테이블 영역 시작 -->
					<table class="table tight-table">
						<thead>
							<tr>
								<th>순번</th>
								<th>제목</th>
								<th>작성일시</th>
								<th>작성자</th>
								<th>첨부파일</th>
							</tr>
						</thead>
						<tbody>
							<c:forEach var="noticeVO" items="${articlePage.content}">
								<tr onclick="noticeDetail(${noticeVO.noticeSn})"
									style="cursor: pointer;">
									<td>${noticeVO.rnum}</td>
									<td>${noticeVO.noticeSj}</td>
									<td class="text-muted mt-1"><img
										src="https://ssl.nexon.com/s2/game/maplestory/renewal/common/sub_date_new.png"
										alt="시계 아이콘"> <fmt:formatDate
											value="${noticeVO.noticeWritngDt}"
											pattern="yyyy-MM-dd HH:mm:ss" /></td>
									<td>${noticeVO.nm}</td>
									<td class="text-center"><c:choose>
											<c:when test="${noticeVO.fileGroupSn > 0}">
												<i class="fas fa-paperclip text-primary"></i>
											</c:when>
											<c:otherwise>
												<i class="far fa-file" style="color: #d0d0d0;"></i>

											</c:otherwise>
										</c:choose>
									</td>
								</tr>
							</c:forEach>
						</tbody>
					</table>
					<div class="card-footer clearfix">${articlePage.pagingArea}</div>
					<!-- 테이블 영역 끝 -->
					
					
					<!-- 모달영역 시작 -->
					<div class="modal fade cute-modal" id="detailModal">
						<div class="modal-dialog modal-xl">
							<div class="modal-content">
								<div class="modal-header">
									<h5 class="modal-title">공지사항</h5>
									<button type="button" class="close" data-dismiss="modal"
										aria-label="Close">
										<span aria-hidden="true">&times;</span>
									</button>
								</div>
								<div class="modal-body">
									<table class="table cute-table">
									<thead>
										<tr>
											<th>순번</th>
											<td><div id="noticeSn"></div></td>
										</tr>
										<tr>
											<th>제목</th>
											<td><div id="noticeSj"></div></td>
										</tr>
										<tr>
											<th>내용</th>
											<td><div id="noticeCn"></div></td>
										</tr>
										<tr>
											<th style="white-space:nowrap;">작성일시</th>
												<td class="text-muted">
												    <img src="https://ssl.nexon.com/s2/game/maplestory/renewal/common/sub_date_new.png" 
												         alt="시계 아이콘"
												         style="width: 20px; vertical-align: middle;">
												    <span id="noticeWritngDt" style="margin-left: 4px;"></span>
												 </td>
										</tr>
										<tr>
											<th>작성자</th>
											<td><div id="empId"></div></td>
										</tr>
										<tr>
											<th>파일</th>
											<td><div id="fileDetailVOList"></div></td>
										</tr>
										</thead>
									</table>
								</div>
								<div class="modal-footer">
									<button type="button"
										class="btn btn-secondary btn-sm btn-round-sm"
										data-dismiss="modal">닫기</button>
								</div>
							</div>
						</div>
					</div>
					<!-- 모달 영역 끝 -->



				</div>
			</div>
		</div>
		<!-- 섹션/컨테이너 영역 끝 -->
</section>
<!-- 섹션/컨테이너 영역 끝 -->

<%@ include file="../include/footer.jsp"%>










<script type="text/javascript">
	document.addEventListener("DOMContentLoaded", function(){
		
		noticeDetail = function(noticeSn){
			
			let data = {
					"noticeSn" : noticeSn
			}
			
			fetch("/notice/detail", {
				method: "post",
				headers: {
					"Content-type":"application/json;charset=UTF-8"
				},
				body: JSON.stringify(data)
			})
			.then(resp => {
				return resp.json();
			})
			.then(data => {
				const notice = data.noticeVO;
				const fileDetailVOList = data.fileDetailVOList;
				
				console.log("data : ",data);
				console.log("fileDetailVOList : ", fileDetailVOList);
				
				document.querySelector("#noticeSn").textContent = notice.noticeSn;
				document.querySelector("#noticeSj").textContent = notice.noticeSj;
				document.querySelector("#noticeCn").innerHTML = notice.noticeCn;
				document.querySelector("#noticeWritngDt").textContent = new Date(notice.noticeWritngDt).toLocaleString();
				document.querySelector("#empId").textContent = notice.nm;
				
			    let filesHtml = '';
		          if (fileDetailVOList && fileDetailVOList.length > 0) {
		            filesHtml = fileDetailVOList.map(fileDetailVO => `<img src="/upload\${fileDetailVO.fileStrelc}" style="height: 100px; margin: 5px;">`).join('');
		          } else {
		            filesHtml = '<p>첨부된 파일이 없습니다.</p>';
		          }
		          document.querySelector("#fileDetailVOList").innerHTML = filesHtml;
				
		          new bootstrap.Modal(document.querySelector('#detailModal')).show();
			})
			.catch(error => console.log("에러:",error));
		}
	})
</script>




<script>
function toggleFilter() {
  const filterBody = document.getElementById('filterBody');
  const toggleBtn = document.querySelector('.filter-btn-toggle i');
  
  filterBody.classList.toggle('collapsed');
  toggleBtn.classList.toggle('rotated');
}
</script>